(()=>{var A=document.getElementById("gameCanvas"),T=A.height*4,w=A.width*4,b=A.width,v=A.height,s=A.getContext("2d"),_=document.getElementById("stats"),N=document.getElementById("radarCanvas"),F=N.getContext("2d");var Q=1200,J=360,tt=7,it=600,B=[80,160,240,320,400],L=350,q=0,et=["#FF0000","#90EE90","#0000FF","#FFFF00","#FFA500","#800080","#00FFFF","#FF69B4","#FFD700","#ADFF2F","#FF4500","#1E90FF"],U=["Slither","Coil","Wiggle","Zigzag","Slink","Curve","Loop","Spiral","Twist","Turn","Wind","Weave","Dart","Dash","Streak","Flash","Glide","Sweep","Dive","Soar","Creep","Crawl","Skulk","Prowl","Lurk","Sneak","Slide","Slip","Shimmy","Wobble","Undulate","Meander","Serpent","Viper","Python","Cobra","Mamba","Asp","Krait","Taipan"],Y=["#FF69B4","#FFD700","#00FF00","#00FFFF","#FF00FF","#ADFF2F","#FFA500","#FFB6C1","#FFFF00","#00CED1","#90EE90","#FF7F50","#FF6347","#7CFC00","#AFEEEE","#F0E68C","#FFFAFA","#DA70D6","#DB7093","#FFC0CB","#FFEFD5","#FFA07A","#98FB98","#FFB347","#FFFFE0"],W={USE_DUAL_COLORS:!0,PLAYER_DUAL_COLOR_CHANCE:1,BOT_DUAL_COLOR_CHANCE:.5},P={turningSpeed:.15,turningSpeedMultiplier:1,directionSmoothing:.1,minSegmentDistance:2,maxSegmentDistance:2.2,smoothingStrength:.1,damping:.8,turnTighteningFactor:.3,maxBendAngle:45},R=class a{static FOOD_DETECTION_RANGE=200;static SNAKE_TARGET_RANGE=300;static MIN_SNAKE_SIZE_TO_CHASE=.85;static AVOIDANCE_WEIGHT=2;static RANDOM_EXPLORATION_WEIGHT=.2;static isNameTaken(t,i){return i.some(e=>e.name===t&&e.isAlive&&!e.isDying)}constructor(t,i,e,o=!1,r="Player"){this.color=e,this.isBot=o,this.name=r,this.useDualColors=W.USE_DUAL_COLORS&&this.shouldUseDualColors(),this.secondaryColor=this.useDualColors?this.generateSecondaryColor(e):e,this.SAFE_SPAWN_DISTANCE=80,this.RESPAWN_TIME=180,this.MIN_SEGMENT_SIZE=1.5,this.BASE_LENGTH=30,this.MAX_LENGTH=Math.floor(this.BASE_LENGTH*14),this.GROWTH_RATE=.01,this.SPEED_BOOST_COST=2,this.BASE_SPEED=160,this.SPEED_BOOST=1.5,this.x=t,this.y=i,this.segments=[],o&&this.reset(t,i),this.size=6,this.lives=1,this.isAlive=!0,this.respawnTimer=0,this.targetPoint=null,this.opacity=1,this.isDying=!1,this.deathProgress=0,this.foodEaten=0,this.MAX_FOOD_EATEN_FOR_SEGMENT=30,this.growthProgress=0,this.baseSpeed=this.BASE_SPEED,this.speed=this.baseSpeed,this.isSpeedingUp=!1,this.lastSpeedBoostTime=0,this.lastLengthChangeTime=0,this.cursorX=0,this.cursorY=0,this.trail=[],this.targetDirection={...this.direction},this.turningSpeed=P.turningSpeed,this.turningSpeedMultiplier=P.turningSpeedMultiplier,this.directionSmoothing=P.directionSmoothing,this.minSegmentDistance=P.minSegmentDistance,this.maxSegmentDistance=P.maxSegmentDistance,this.smoothingStrength=P.smoothingStrength,this.damping=P.damping,this.turnTighteningFactor=P.turnTighteningFactor,this.maxBendAngle=P.maxBendAngle}reset(t,i){this.x=t,this.y=i,this.segments=[],this.segments.push({x:t,y:i});let e=Math.random()*2*Math.PI;this.direction={x:Math.cos(e),y:Math.sin(e)},this.targetDirection={...this.direction},this.isAlive=!0,this.opacity=1,this.isDying=!1,this.deathProgress=0}shouldUseDualColors(){let t=this.isBot?W.BOT_DUAL_COLOR_CHANCE:W.PLAYER_DUAL_COLOR_CHANCE;return Math.random()<t}getCurrentMaxLength(){let t=this.MAX_LENGTH-this.BASE_LENGTH,i=Math.min(t*this.foodEaten*this.GROWTH_RATE,t);return Math.floor(this.BASE_LENGTH+i)}grow(t){let e=1+this.segments.length/11;e=Math.min(e,this.MAX_FOOD_EATEN_FOR_SEGMENT);let o=t/e;this.growthProgress+=o,this.growthProgress>=1&&(this.growthProgress-=1,this.segments.push({...this.segments[this.segments.length-1]})),this.foodEaten+=o}update(t,i,e){this.updatedScale=(()=>{for(let c=B.length-1;c>=0;c--)if(this.segments.length>B[c])return 1.6+c*.4;return 1.6})();let o=this.getCurrentMaxLength();if(this.isSpeedingUp){if(this.segments.length<=this.BASE_LENGTH){this.isSpeedingUp=!1,this.speed=this.baseSpeed;return}let c=Date.now();if(this.lastShrinkTime||(this.lastShrinkTime=c),c-this.lastShrinkTime>=200){if(this.segments.length>this.BASE_LENGTH){let y=this.segments.pop();if(y){let u=y.x+(Math.random()-.5)*10,D=y.y+(Math.random()-.5)*10,M=new O;M.position={x:u,y:D},t.push(M),this.foodEaten=Math.max(0,this.foodEaten-.2)}}else this.isSpeedingUp=!1;this.lastShrinkTime=c}this.speed=this.baseSpeed*this.SPEED_BOOST}else this.lastShrinkTime=null,this.speed=this.baseSpeed;if(this.isDying){this.deathProgress+=.02,this.opacity=Math.max(0,1-this.deathProgress),this.deathProgress>=1&&(this.isDying=!1,this.isAlive=!1,this.lives>0&&(this.respawnTimer=this.RESPAWN_TIME));return}if(!this.isAlive){if(this.lives<=0)return;this.respawnTimer--,this.respawnTimer<=0&&this.respawn();return}this.isBot&&this.updateAI(t,i);let r=Math.atan2(this.direction.y,this.direction.x)*180/Math.PI,n=Math.atan2(this.targetDirection.y,this.targetDirection.x)*180/Math.PI,l=st(r,n,this.turningSpeed*e*this.turningSpeedMultiplier);this.direction.x=Math.cos(l*Math.PI/180),this.direction.y=Math.sin(l*Math.PI/180);let h=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);if(h===0?this.direction={x:1,y:0}:(this.direction.x/=h,this.direction.y/=h),this.targetDirection){let c=this.directionSmoothing,m=Math.atan2(this.direction.y,this.direction.x),p=Math.atan2(this.targetDirection.y,this.targetDirection.x)-m;for(;p>Math.PI;)p-=Math.PI*2;for(;p<-Math.PI;)p+=Math.PI*2;let u=m+p*c;this.direction.x=Math.cos(u),this.direction.y=Math.sin(u)}let d=this.segments[0],f=this.speed*e,g={x:d.x+this.direction.x*f,y:d.y+this.direction.y*f};this.segments.unshift(g),this.applySegmentSmoothing(e),this.isSpeedingUp?this.trail.push({x:g.x,y:g.y}):this.trail=[];for(let c=1;c<this.segments.length;c++){let m=this.segments[c-1],y=this.segments[c],p=m.x-y.x,u=m.y-y.y,D=Math.sqrt(p*p+u*u),M=Math.abs(this.targetDirection.x-this.direction.x)+Math.abs(this.targetDirection.y-this.direction.y),C=this.size*(3-this.turnTighteningFactor*M);if(D>C){let X=this.size*(1.5+M)/D;y.x=m.x-p*X,y.y=m.y-u*X}}for(;this.segments.length>o;)this.segments.pop()}applySegmentSmoothing(t){let i=this.size*this.minSegmentDistance,e=this.size*this.maxSegmentDistance,o=this.smoothingStrength;for(let r=1;r<this.segments.length;r++){let n=this.segments[r-1],l=this.segments[r],h=n.x-l.x,d=n.y-l.y,f=Math.sqrt(h*h+d*d);if(f<i)continue;let g=h/f,c=d/f,m=i,y=Math.abs(this.targetDirection.x-this.direction.x+this.targetDirection.y-this.direction.y);m-=y*this.size*.3;let p=n.x-g*m,u=n.y-c*m;l.vx||(l.vx=0),l.vy||(l.vy=0);let D=Math.min(f/e,1),M=o*(1+D);l.vx+=(p-l.x)*M,l.vy+=(u-l.y)*M;let C=this.damping;l.vx*=C,l.vy*=C,l.x+=l.vx*t,l.y+=l.vy*t,f>e&&(l.x=n.x-g*e,l.y=n.y-c*e,l.vx=0,l.vy=0)}}calculateBendAngle(t){let i=this.segments[t-1],e=this.segments[t],o=e.x-i.x,r=e.y-i.y;return Math.atan2(r,o)*(180/Math.PI)}applyBend(t,i){let e=Math.min(Math.max(i,-this.maxBendAngle),this.maxBendAngle);t.x+=Math.cos(e*Math.PI/180)*this.size*.05,t.y+=Math.sin(e*Math.PI/180)*this.size*.05}canSpeedBoost(){return this.segments.length>this.BASE_LENGTH}updateAI(t,i){let e=this.segments[0],o=this.calculateAvoidanceForce(e,i),r=this.determineTargetDirection(e,t,i,o);this.applyMovement(r)}calculateAvoidanceForce(t,i){let e={x:0,y:0},o=this.size*3;i.forEach(n=>{if(n!==this&&n.isAlive&&!n.isDying){let l=n.segments[0],h=l.x-t.x,d=l.y-t.y,f=Math.sqrt(h*h+d*d);if(f<o){let g=(1-f/o)*a.AVOIDANCE_WEIGHT;e.x-=h/f*g,e.y-=d/f*g}}});let r=Math.sqrt(e.x*e.x+e.y*e.y);return r>0&&(e.x/=r,e.y/=r),e}determineTargetDirection(t,i,e,o){let r=null,n=1/0,l=null,h=1/0,d=null,f=1/0;i.forEach(y=>{let p=y.position.x-t.x,u=y.position.y-t.y,D=Math.sqrt(p*p+u*u);D<n&&(n=D,r=y)}),e.forEach(y=>{if(y!==this&&y.isAlive&&!y.isDying){let p=y.segments[0],u=p.x-t.x,D=p.y-t.y,M=Math.sqrt(u*u+D*D),C=y.segments.length/this.segments.length;C>1.2&&M<a.SNAKE_TARGET_RANGE*1.5?M<f&&(f=M,d=y):C<a.MIN_SNAKE_SIZE_TO_CHASE&&M<a.SNAKE_TARGET_RANGE&&M<h&&(h=M,l=y)}});let g=this.direction.x,c=this.direction.y;if(d){let y=t.x-d.segments[0].x,p=t.y-d.segments[0].y,u=Math.sqrt(y*y+p*p);g=y/u,c=p/u}else if(l&&Math.random()<.7)g=(l.segments[0].x-t.x)/h,c=(l.segments[0].y-t.y)/h;else if(r)g=(r.position.x-t.x)/n,c=(r.position.y-t.y)/n;else{let y=Date.now()*.001;g=Math.cos(y*.5)*(1-a.RANDOM_EXPLORATION_WEIGHT),c=Math.sin(y*.7)*(1-a.RANDOM_EXPLORATION_WEIGHT)}g+=o.x,c+=o.y;let m=Math.sqrt(g*g+c*c);return m>0?{x:g/m,y:c/m}:{x:0,y:0}}applyMovement(t){this.direction.x=this.direction.x*(1-.1)+t.x*.1,this.direction.y=this.direction.y*(1-.1)+t.y*.1;let e=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=e,this.direction.y/=e}getDistance(t,i){let e=t.x-i.x,o=t.y-i.y;return Math.sqrt(e*e+o*o)}respawn(){if(this.lives>0){let t=this.findSafeSpawnPosition();this.reset(t.x,t.y),this.targetPoint=null}}findSafeSpawnPosition(){let i=this.SAFE_SPAWN_DISTANCE*this.SAFE_SPAWN_DISTANCE;for(let e=0;e<20;e++){let o=Math.floor(Math.random()*(w-2*L))+L,r=Math.floor(Math.random()*(T-2*L))+L;if(!this.isPositionNearSnakes(o,r,i))return{x:o,y:r}}return{x:w/2,y:T/2}}isPositionNearSnakes(t,i,e){if(E.length===0)return!1;for(let o of E){if(o===this||!o.isAlive||o.isDying)continue;let r=t-o.segments[0].x,n=i-o.segments[0].y;if(r*r+n*n<e)return!0}return!1}generateSecondaryColor(t){if(Math.random()<.5){let i,e,o;if(t.startsWith("#")){let h=t.substring(1);i=parseInt(h.substring(0,2),16),e=parseInt(h.substring(2,4),16),o=parseInt(h.substring(4,6),16)}else if(t.startsWith("rgb"))[i,e,o]=t.match(/\d+/g).map(Number);else return z();let r=255-i,n=255-e,l=255-o;return`rgb(${r}, ${n}, ${l})`}else return z()}draw(){if(!this.isAlive&&!this.isDying)return;let t=1.6,i=1;for(let n=B.length-1;n>=0;n--)if(this.segments.length>B[n]){i=(1.6+n*.4)/1.6;break}if(s.globalAlpha=this.opacity,this.isSpeedingUp)for(let n=0;n<this.segments.length;n++){let l=this.segments[n],h=l.x-S.x,d=l.y-S.y;if(h>=-10&&h<=b+10&&d>=-10&&d<=v+10){let f=(n+1)/this.trail.length*.7,g=f*.5;s.fillStyle=`rgba(255, 215, 0, ${g})`,s.shadowColor="yellow",s.shadowBlur=10*i,s.beginPath();let c=Math.max(0,this.size*(1.6-n/this.trail.length/3))*t*i;s.arc(h,d,c,0,Math.PI*2),s.fill(),s.shadowColor="transparent",s.shadowBlur=0,s.fillStyle=`rgba(255, 170, 0, ${f})`,s.beginPath();let m=Math.max(0,this.size*(1.4-n/this.trail.length/3))*t*i;s.arc(h,d,m,0,Math.PI*2),s.fill()}}s.fillStyle=this.color;for(let n=this.segments.length-1;n>=0;n--){let l=this.segments[n],h=l.x-S.x,d=l.y-S.y;if(h>=-10&&h<=b+10&&d>=-10&&d<=v+10){let g=this.size*this.updatedScale;if(n===0){let c=this.direction.x*this.targetDirection.x+this.direction.y*this.targetDirection.y,m=Math.max(.3,c);g*=m}s.fillStyle=this.useDualColors&&Math.floor(n/10)%2===0?this.color:this.secondaryColor,s.beginPath(),s.arc(h,d,g,0,Math.PI*2),s.fill()}}let e=this.segments[0],o=e.x-S.x,r=e.y-S.y;if(o>=-10&&o<=b+10&&r>=-10&&r<=v+10){let n=this.updatedScale/t,l=this.updatedScale/t;s.fillStyle="white";let h=2*t*n,d=1.5*t*n,f=this.direction.x*h,g=this.direction.y*h;s.beginPath(),s.arc(o+f-g,r+g+f,d,0,Math.PI*2),s.arc(o+f+g,r+g-f,d,0,Math.PI*2),s.fill();let c=.9*l,m=d*.8,y=this.targetDirection.x*c,p=this.targetDirection.y*c,u=this.targetDirection.x*c,D=this.targetDirection.y*c;s.fillStyle="black",s.beginPath(),s.arc(o+f-g+y,r+g+f+p,m,0,Math.PI*2),s.arc(o+f+g+u,r+g-f+D,m,0,Math.PI*2),s.fill(),s.fillStyle="rgba(250, 250, 250, 0.6)",s.font=`bold ${12*t}px Arial`,s.textAlign="center",s.textBaseline="bottom";let M=this.size*Math.max(1-0/this.segments.length,this.MIN_SEGMENT_SIZE)*t+5;s.fillText(this.name,o,r-M)}s.globalAlpha=1}},O=class{constructor(t=!1){this.size=t?8:4,this.value=t?3:1,this.isFlying=t,this.resetPosition(),this.color=this.isFlying?"gold":"lightgreen",this.shadowColor=this.isFlying?"rgba(255, 215, 0, 0.3)":"rgba(144, 238, 144, 0.3)",this.floatingSpeed=.01,this.floatingAmplitude=.8,this.isFlying&&(this.blinkInterval=500,this.lastBlink=0,this.isFlickering=!1,this.fleeingBlinkInterval=300,this.fleeingLastBlink=0,this.setRandomDirection(),this.baseSpeed=1,this.speed=this.baseSpeed*1.3,this.wobbleInterval=150,this.lastWobble=Date.now(),this.maxWanderDistance=150,this.initialPosition={...this.position})}setRandomDirection(){this.direction={x:Math.random()-.5,y:Math.random()-.5};let t=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=t,this.direction.y/=t}resetPosition(){this.position={x:Math.random()*(w-100)+50,y:Math.random()*(T-100)+50}}update(){if(this.isFlying){if(!this.fleeing){let i=Date.now();i-this.lastWobble>this.wobbleInterval&&(this.setRandomDirection(),this.lastWobble=i)}if(this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.position.x<0&&(this.position.x=w),this.position.x>w&&(this.position.x=0),this.position.y<0&&(this.position.y=T),this.position.y>T&&(this.position.y=0),this.getDistance(this.initialPosition,this.position)>this.maxWanderDistance){let i=this.initialPosition.x-this.position.x,e=this.initialPosition.y-this.position.y,o=Math.sqrt(i*i+e*e);this.direction.x=i/o,this.direction.y=e/o,this.speed=this.baseSpeed}else this.speed=this.baseSpeed*1.3}}getDistance(t,i){let e=t.x-i.x,o=t.y-i.y;return Math.sqrt(e*e+o*o)}flee(t,i){if(this.isFlying&&!this.fleeing){let e=this.position.x-t.x,o=this.position.y-t.y,r=Math.sqrt(e*e+o*o);if(r<70){let n={x:e/r,y:o/r};this.direction=n,this.speed=this.baseSpeed*8,this.fleeing=!0,this.fleeingColor="yellow",this.size=12,setTimeout(()=>{this.speed=this.baseSpeed*1.3,this.fleeing=!1,this.fleeingColor="red",this.size=9},Math.random()*1500+500)}}}draw(){let t=0;if(!this.isFlying){let o=Date.now()*this.floatingSpeed;t=Math.sin(o+this.position.y)*this.floatingAmplitude}let i=this.position.x-S.x,e=this.position.y-S.y+t;if(i>=-10&&i<=b+10&&e>=-10&&e<=v+10&&(this.isFlying||(s.shadowColor="white",s.shadowBlur=32,s.fillStyle="white",s.globalAlpha=.8,s.beginPath(),s.arc(i,e,this.size*.8,0,Math.PI*2),s.fill(),s.globalAlpha=1,s.shadowColor="transparent",s.shadowBlur=0,s.shadowColor=this.shadowColor,s.shadowBlur=64,s.globalAlpha=.5,s.fillStyle=this.color,s.beginPath(),s.arc(i,e,this.size*1.2,0,Math.PI*2),s.fill(),s.globalAlpha=1,s.shadowColor="transparent",s.shadowBlur=0,s.fillStyle=this.color,s.globalAlpha=.9,s.beginPath(),s.arc(i,e,this.size,0,Math.PI*2),s.fill(),s.globalAlpha=1),this.isFlying)){let o=this.fleeing?this.fleeingBlinkInterval:this.blinkInterval,r=this.fleeingLastBlink||this.lastBlink,n=this.fleeing?6:5,l=this.size*1.1,h=Date.now();h-r>=o&&(this.fleeing?this.fleeingLastBlink=h:this.lastBlink=h),s.fillStyle="white",s.globalAlpha=.95,s.beginPath(),s.arc(i,e,l*.3,0,Math.PI*2),s.fill(),s.globalAlpha=1,s.shadowColor=this.shadowColor,s.shadowBlur=l*n*.8,s.fillStyle=this.color,s.globalAlpha=.7,s.beginPath(),s.arc(i,e,l*.6,0,Math.PI*2),s.fill(),s.globalAlpha=1,s.shadowColor="transparent",s.shadowBlur=0,s.shadowColor=this.shadowColor,s.shadowBlur=l*n*1.2,s.fillStyle=this.color,s.globalAlpha=.5,s.beginPath(),s.arc(i,e,l*.9,0,Math.PI*2),s.fill(),s.globalAlpha=1,s.shadowColor="transparent",s.shadowBlur=0,s.fillStyle=this.color,s.globalAlpha=.9,s.beginPath(),s.arc(i,e,l,0,Math.PI*2),s.fill(),s.globalAlpha=1}}};function z(){return Y[Math.floor(Math.random()*Y.length)]}function k(a,t,i){return a+(t-a)*i}function st(a,t,i){let e=(t-a+360)%360;return e>180&&(e-=360),a+e*i}var S={x:0,y:0,update:function(a,t){let e=a-b/2,o=t-v/2;this.x+=(e-this.x)*.1,this.y+=(o-this.y)*.1}};function j(a,t,i,e){let o;do o=U[Math.floor(Math.random()*U.length)];while(R.isNameTaken(o,e));let r=Math.random()*w,n=Math.random()*T;return new R(r,n,i,!0,o)}var G=[],E=[],x=new R(A.width/2,A.height/2,"#4444ff",!1,"Player");E.push(x);var $=x.findSafeSpawnPosition();x.reset($.x,$.y);for(let a=0;a<tt;a++){let t=j(Math.random()*A.width,Math.random()*A.height,z(),E);G.push(t),E.push(t)}var I=Array(J).fill(null).map(()=>new O),nt=9e3;setInterval(()=>{Math.random()<.4&&I.push(new O(!0))},nt);document.addEventListener("mousemove",a=>{if(!x.isAlive||x.isDying)return;let t=a.clientX-A.offsetLeft+S.x,i=a.clientY-A.offsetTop+S.y,e=x.segments[0],o=t-e.x,r=i-e.y,n={x:o,y:r},l=Math.sqrt(n.x*n.x+n.y*n.y);l>0?(n.x/=l,n.y/=l):n={x:1,y:0};let h=.5;x.targetDirection.x=k(x.targetDirection.x,n.x,h),x.targetDirection.y=k(x.targetDirection.y,n.y,h)});document.addEventListener("keydown",a=>{a.code==="Space"&&x.isAlive&&x.canSpeedBoost()&&(x.isSpeedingUp=!0,x.lastSpeedBoostTime=Date.now())});document.addEventListener("keyup",a=>{a.code==="Space"&&(x.isSpeedingUp=!1)});document.addEventListener("mousedown",a=>{a.button===0&&x.isAlive&&x.canSpeedBoost()&&(x.isSpeedingUp=!0)});document.addEventListener("mouseup",a=>{a.button===0&&(x.isSpeedingUp=!1)});function ot(a){let t=null,i=1/0,e=K(a);return et.forEach(o=>{let r=K(o),n=at(e,r);n<i&&(i=n,t=o)}),t}function K(a){let t=parseInt(a.slice(1,3),16),i=parseInt(a.slice(3,5),16),e=parseInt(a.slice(5,7),16);return{r:t,g:i,b:e}}function at(a,t){return Math.sqrt(.3*Math.pow(a.r-t.r,2)+.59*Math.pow(a.g-t.g,2)+.11*Math.pow(a.b-t.b,2))}function rt(){let t,i;do t=Math.random()*w,i=Math.random()*T;while(t<400||t>w-400||i<400||i>T-400);return{x:t,y:i}}function ht(){E.forEach(a=>{if(!a.isAlive||a.isDying)return;let t=a.segments[0];if(t.x<=0||t.x>=w||t.y<=0||t.y>=T){V(a);return}let i=a.direction;for(let e=I.length-1;e>=0;e--){let o=I[e];o.isFlying&&!o.fleeing&&o.flee(t,i);let r=t.x-o.position.x,n=t.y-o.position.y;if(Math.sqrt(r*r+n*n)<a.size+o.size){I.splice(e,1);let h=Math.random()<.1,d=Date.now();if(I.length<Q&&d-q>=it){let f=Math.random()<.1,g=rt(),c=new O(f);c.position=g,I.push(c),q=d}a.segments.length<a.MAX_LENGTH&&a.grow(o.value),a.foodEaten+=o.value*.2;break}}});for(let a=0;a<E.length;a++){let t=E[a];if(!t.isAlive||t.isDying)continue;let i=t.segments[0];for(let e=0;e<E.length;e++){let o=E[e];if(!(t===o||!o.isAlive||o.isDying))for(let r=0;r<o.segments.length;r++){let n=o.segments[r],l=i.x-n.x,h=i.y-n.y,d=Math.sqrt(l*l+h*h),f=r===0?o.size:o.size*.8;if(d<t.size+f*.7){V(t);return}}}}}function V(a){if(a.lives=Math.max(0,a.lives-1),a.isDying=!0,a.deathProgress=0,a.lives<=0){let t=[...a.segments],i=2.5,e=ot(a.color);t.forEach(n=>{let l=Math.random()*2*Math.PI,h=Math.random()*a.size*i,d=n.x+h*Math.cos(l),f=n.y+h*Math.sin(l),g=new O;g.color=e,g.position={x:d,y:f},I.push(g)});let o=G.indexOf(a);o!==-1&&G.splice(o,1);let r=E.indexOf(a);if(r!==-1&&E.splice(r,1),a.isBot){let n=j(0,0,lt(),E),l=n.findSafeSpawnPosition();n.reset(l.x,l.y);let h={x:0,y:0},d=-1;for(let m of E)if(m.isAlive&&m!==n){let y=n.segments[0].x-m.segments[0].x,p=n.segments[0].y-m.segments[0].y,u=Math.sqrt(y*y+p*p);u>d&&(d=u,h={x:-y,y:-p})}let f=Math.sqrt(h.x*h.x+h.y*h.y);if(f>0)h.x/=f,h.y/=f;else{h={x:Math.random()-.5,y:Math.random()-.5};let m=Math.sqrt(h.x*h.x+h.y*h.y);h.x/=m,h.y/=m}if(h.x!==n.direction.x||h.y!==n.direction.y)n.targetDirection=h;else{let m=Math.random()*.1-.05,y=h.x*Math.cos(m)-h.y*Math.sin(m),p=h.x*Math.sin(m)+h.y*Math.cos(m);n.targetDirection={x:y,y:p}}let g=.05;n.targetDirection.x+=(Math.random()-.5)*g,n.targetDirection.y+=(Math.random()-.5)*g;let c=Math.sqrt(n.targetDirection.x*n.targetDirection.x+n.targetDirection.y*n.targetDirection.y);n.targetDirection.x/=c,n.targetDirection.y/=c,n.direction=h,E.push(n),G.push(n)}}}function lt(){let a=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),i=Math.floor(Math.random()*256);return`rgb(${a}, ${t}, ${i})`}function ct(){_.innerHTML=E.map(t=>{let i="";return t.isAlive&&!t.isDying?i='<span class="active-indicator"></span>':t.lives>0&&(i='<span class="respawning-indicator">|</span>'),`
                <div class="player-stats">
                    <strong>${t.name}</strong>: 
                    ${t.lives} ${t.lives===1?"life":"lives"} | 
                    ${t.segments.length}/${t.getCurrentMaxLength()} |
                    ${i} 
                </div>
            `}).join(""),document.querySelectorAll(".respawning-indicator").forEach(t=>{let i=0,e=setInterval(()=>{i+=5,t.style.transform=`rotate(${i}deg)`,i>=360&&(i=0)},20)}),_.style.position="absolute",_.style.top="56px",_.style.left="1058px",_.style.color="white",_.style.fontSize="12px",_.style.fontFamily="sans-serif",_.style.pointerEvents="none",_.style.zIndex="100",_.style.opacity="10"}function gt(){F.clearRect(0,0,N.width,N.height);let a=Math.min(N.width/w,N.height/T);I.forEach(l=>{let h=l.position.x*a,d=l.position.y*a;F.fillStyle=l.isFlying?"gold":"lightgreen",F.beginPath(),F.arc(h,d,1,0,Math.PI*2),F.fill()});let t=x.segments[0].x*a,i=x.segments[0].y*a;F.fillStyle=x.color,F.beginPath(),F.arc(t,i,2,0,Math.PI*2),F.fill();let e=S.x*a,o=S.y*a,r=b*a,n=v*a;F.strokeStyle="white",F.lineWidth=1,F.strokeRect(e,o,r,n)}function dt(a){ct();let t=[...E];x.isAlive&&S.update(x.segments[0].x,x.segments[0].y),s.clearRect(0,0,b,v),s.strokeStyle="#FF4444",s.lineWidth=4,s.strokeRect(-S.x,-S.y,w,T),s.strokeStyle="#333333",s.lineWidth=1;let i=100,e=Math.floor(S.x/i)*i,o=Math.floor(S.y/i)*i;for(let r=e;r<S.x+b+i;r+=i)r>=0&&r<=w&&(s.beginPath(),s.moveTo(r-S.x,0),s.lineTo(r-S.x,v),s.stroke());for(let r=o;r<S.y+v+i;r+=i)r>=0&&r<=T&&(s.beginPath(),s.moveTo(0,r-S.y),s.lineTo(b,r-S.y),s.stroke());I.forEach(r=>{r.update(),r.draw()}),t.forEach(r=>{r.update(I,t,a),r.draw()}),ht()}var Z=performance.now();function H(){s.clearRect(0,0,A.width,A.height),gt();let a=performance.now(),t=(a-Z)/1e3;t=Math.min(t,1/30),dt(t),x.lives<=0?(s.fillStyle="rgba(0, 0, 0, 0.5)",s.fillRect(0,0,A.width,A.height),s.fillStyle="white",s.font="30px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText("Game Over!",A.width/2,A.height/2),cancelAnimationFrame(H)):(Z=a,requestAnimationFrame(H))}H();})();
