(()=>{var M=document.getElementById("gameCanvas"),b=M.height*3,_=M.width*3,B=M.width,C=M.height,h=M.getContext("2d"),R=document.getElementById("stats"),W=document.getElementById("radarCanvas"),I=W.getContext("2d");var j=200,J=60,K=5,Q=2e3,tt=150,it=300,k=0,st=["#FF0000","#90EE90","#0000FF","#FFFF00","#FFA500","#800080","#00FFFF","#FF69B4","#FFD700","#ADFF2F","#FF4500","#1E90FF"],Y=["Slitherin","Viper","Cobra","Python","Anaconda","Mamba","Asp","Rattler","Boa","Serpent","Sidewinder","Boomslang","Racer","Kingsnake","Coral","Cottonmouth","Copperhead","Harlequin","Gaboon","Moccasin"],U=["#FF69B4","#FFD700","#00FF00","#00FFFF","#FF00FF","#ADFF2F","#FFA500","#FFB6C1","#FFFF00","#00CED1","#90EE90","#FF7F50","#FF6347","#7CFC00","#AFEEEE","#F0E68C","#FFFAFA","#DA70D6","#DB7093","#FFC0CB","#FFEFD5","#FFA07A","#98FB98","#FFB347","#FFFFE0"],H=class{static isNameTaken(t,i){return i.some(s=>s.name===t&&s.isAlive&&!s.isDying)}constructor(t,i,s,e=!1,o="Player"){this.color=s,this.isBot=e,this.name=o,this.SAFE_SPAWN_DISTANCE=70,this.RESPAWN_TIME=180,this.MIN_SEGMENT_SIZE=1.5,this.BASE_LENGTH=50,this.MAX_LENGTH=Math.floor(this.BASE_LENGTH*6.6),this.GROWTH_RATE=.02,this.SPEED_BOOST_COST=2,this.BASE_SPEED=160,this.SPEED_BOOST=1.5,this.reset(t,i),this.size=6,this.lives=3,this.isAlive=!0,this.respawnTimer=0,this.targetPoint=null,this.opacity=1,this.isDying=!1,this.deathProgress=0,this.foodEaten=0,this.baseSpeed=this.BASE_SPEED,this.speed=this.baseSpeed,this.speedBoost=1.5,this.isSpeedingUp=!1,this.speedBoostCost=2,this.lastSpeedBoostTime=0,this.lastLengthChangeTime=0,this.cursorX=0,this.cursorY=0,this.trail=[],this.trailMaxLength=25,this.turningSpeed=.35,this.targetDirection={...this.direction},this.segmentSmoothing=.25,this.maxBendAngle=70}reset(t,i){this.segments=[],this.segments.push({x:t,y:i}),this.direction={x:1,y:0},this.isAlive=!0,this.opacity=1,this.isDying=!1,this.deathProgress=0}getCurrentMaxLength(){let t=this.MAX_LENGTH-this.BASE_LENGTH,i=Math.min(t*this.foodEaten*this.GROWTH_RATE,t);return Math.floor(this.BASE_LENGTH+i)}grow(t){let s=1/Math.sqrt(this.segments.length),e=t*.1*s;this.foodEaten+=e;let o={...this.segments[this.segments.length-1]};this.segments.push(o)}update(t,i,s){this.updatedScale=this.segments.length>it?2.4:this.segments.length>tt?2:1.6;let e=this.getCurrentMaxLength();if(this.isSpeedingUp){if(this.segments.length<=this.BASE_LENGTH){this.isSpeedingUp=!1,this.speed=this.baseSpeed;return}let l=Date.now();if(this.lastShrinkTime||(this.lastShrinkTime=l),l-this.lastShrinkTime>=200){if(this.segments.length>this.BASE_LENGTH){let x=this.segments.pop();if(x){let d=x.x+(Math.random()-.5)*10,u=x.y+(Math.random()-.5)*10,g=new N;g.position={x:d,y:u},t.push(g),this.foodEaten=Math.max(0,this.foodEaten-.2)}}else this.isSpeedingUp=!1;this.lastShrinkTime=l}this.speed=this.baseSpeed*this.SPEED_BOOST}else this.lastShrinkTime=null,this.speed=this.baseSpeed;if(this.isDying){this.deathProgress+=.02,this.opacity=Math.max(0,1-this.deathProgress),this.deathProgress>=1&&(this.isDying=!1,this.isAlive=!1,this.lives>0&&(this.respawnTimer=this.RESPAWN_TIME));return}if(!this.isAlive){if(this.lives<=0)return;this.respawnTimer--,this.respawnTimer<=0&&this.respawn();return}this.isBot&&this.updateAI(t,i);let o=Math.atan2(this.direction.y,this.direction.x)*180/Math.PI,a=Math.atan2(this.targetDirection.y,this.targetDirection.x)*180/Math.PI,r=nt(o,a,this.turningSpeed*s*5);this.direction.x=Math.cos(r*Math.PI/180),this.direction.y=Math.sin(r*Math.PI/180);let f=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);f===0?this.direction={x:1,y:0}:(this.direction.x/=f,this.direction.y/=f);let E=this.segments[0],T=this.speed*s,m={x:E.x+this.direction.x*T,y:E.y+this.direction.y*T};m.x<0&&(m.x=_),m.x>_&&(m.x=0),m.y<0&&(m.y=b),m.y>b&&(m.y=0),this.segments.unshift(m),this.applySegmentSmoothing(s),this.isSpeedingUp?(this.trail.push({x:m.x,y:m.y}),this.trail.length>this.trailMaxLength&&this.trail.shift()):this.trail=[];for(let l=1;l<this.segments.length;l++){let S=this.segments[l-1],x=this.segments[l],w=S.x-x.x,d=S.y-x.y,u=Math.sqrt(w*w+d*d);if(u>this.size*3){let g=this.size*1.5/u;x.x=S.x-w*g,x.y=S.y-d*g}}for(;this.segments.length>e;)this.segments.pop()}applySegmentSmoothing(t){for(let i=1;i<this.segments.length;i++){let s=this.segments[i-1],e=this.segments[i],o=this.segmentSmoothing*(1-i/this.segments.length*.7),a=s.x-e.x,c=s.y-e.y,r=Math.sqrt(a*a+c*c),f=i===1?this.size*4:this.size*3.5,E=a/r||0,T=c/r||0,m=s.x-E*f,l=s.y-T*f;e.vx||(e.vx=0),e.vy||(e.vy=0);let S=(m-e.x)*o*t,x=(l-e.y)*o*t,w=.9;if(e.vx=e.vx*w+S,e.vy=e.vy*w+x,e.x+=e.vx*t,e.y+=e.vy*t,i>1){let d=this.calculateBendAngle(i-1),u=this.calculateBendAngle(i),g=(d+u)/2;this.applyBend(e,g)}}}calculateBendAngle(t){let i=this.segments[t-1],s=this.segments[t],e=s.x-i.x,o=s.y-i.y;return Math.atan2(o,e)*(180/Math.PI)}applyBend(t,i){let s=Math.min(Math.max(i,-this.maxBendAngle),this.maxBendAngle);t.x+=Math.cos(s*Math.PI/180)*this.size*.05,t.y+=Math.sin(s*Math.PI/180)*this.size*.05}canSpeedBoost(){return this.segments.length>this.BASE_LENGTH}updateAI(t,i){let s=this.segments[0],e=50,o=2,a=10,c=5,r=20,f=3,E=100,T=.3,m=100,l=null,S={x:0,y:0},x=null,w=1/0;if(t.forEach(d=>{let u=this.getDistance(s,d.position);u<w&&(w=u,x=d)}),x&&(l=x.position),i.forEach(d=>{if(d!==this&&d.isAlive&&!d.isDying){let u=d.segments[0],g=1/0,F={...u};for(let A=0;A<c;A++){F.x+=d.direction.x*r,F.y+=d.direction.y*r;let v=this.getDistance(s,F);if(v<g){g=v;let O=F.x-s.x,L=F.y-s.y,z=d.size*f;l={x:F.x+O*z/v,y:F.y+L*z/v}}}for(let A of d.segments){let v=this.getDistance(s,A);if(v<this.size*2){let O=s.x-A.x,L=s.y-A.y,z={x:O/v,y:L/v};S.x+=z.x*a,S.y+=z.y*a}}}}),l){l.x+=S.x,l.y+=S.y;let d=Math.random()*Math.PI*2;l.x+=Math.cos(d)*e*o,l.y+=Math.sin(d)*e*o,l.x+=(Math.random()-.5)*T,l.y+=(Math.random()-.5)*T;let u=l.x-s.x,g=l.y-s.y,F=Math.sqrt(u*u+g*g);F>0&&(l.x=s.x+u/F*m,l.y=s.y+g/F*m)}else{let d=Math.random()*Math.PI*2;l={x:s.x+this.direction.x+Math.cos(d)*e*o,y:s.y+this.direction.y+Math.sin(d)*e*o}}if(l){let d=l.x-s.x,u=l.y-s.y,g={x:d,y:u},F=Math.sqrt(g.x*g.x+g.y*g.y);F>0?(g.x/=F,g.y/=F):g={x:1,y:0};let A=.1;this.direction.x=this.direction.x*(1-A)+g.x*A,this.direction.y=this.direction.y*(1-A)+g.y*A;let v=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=v,this.direction.y/=v}x&&x.isFlying?this.isChasingFlyingFood=!0:this.isChasingFlyingFood=!1}getDistance(t,i){let s=t.x-i.x,e=t.y-i.y;return Math.sqrt(s*s+e*e)}respawn(){if(this.lives>0){let t=this.findSafeSpawnPosition();this.reset(t.x,t.y),this.targetPoint=null}}findSafeSpawnPosition(){let t=0,i;do i={x:Math.random()*(_-100)+50,y:Math.random()*(b-100)+50},t++;while(this.isPositionNearSnakes(i)&&t<10);return i}isPositionNearSnakes(t){return D.some(i=>i===this||!i.isAlive||i.isDying?!1:this.getDistance(t,i.segments[0])<this.SAFE_SPAWN_DISTANCE)}draw(){if(!this.isAlive&&!this.isDying)return;let t=1.6;h.globalAlpha=this.opacity,this.isSpeedingUp&&this.trail.forEach((o,a)=>{let c=o.x-p.x,r=o.y-p.y;if(c>=-10&&c<=B+10&&r>=-10&&r<=C+10){let f=(a+1)/this.trail.length*.5,E=f*.3;h.fillStyle=`rgba(255, 190, 0, ${E})`,h.beginPath(),h.arc(c,r,this.size*(1.4-a/this.trail.length/3)*t,0,Math.PI*2),h.fill(),h.fillStyle=`rgba(255, 153, 0, ${f})`,h.beginPath(),h.arc(c,r,this.size*(1.2-a/this.trail.length/3)*t,0,Math.PI*2),h.fill()}}),h.fillStyle=this.color,this.segments.forEach((o,a)=>{let c=o.x-p.x,r=o.y-p.y;if(c>=-10&&c<=B+10&&r>=-10&&r<=C+10){let E=Math.max(this.size*(1-a/this.segments.length),this.MIN_SEGMENT_SIZE)*this.updatedScale;if(a===0){let T=this.direction.x*this.targetDirection.x+this.direction.y*this.targetDirection.y,m=Math.max(.3,T);E*=m}h.beginPath(),h.arc(c,r,E,0,Math.PI*2),h.fill()}});let i=this.segments[0],s=i.x-p.x,e=i.y-p.y;if(s>=-10&&s<=B+10&&e>=-10&&e<=C+10){h.fillStyle="white";let o=2*t,a=1.5*t,c=this.direction.x*o,r=this.direction.y*o;h.beginPath(),h.arc(s+c-r,e+r+c,a,0,Math.PI*2),h.arc(s+c+r,e+r-c,a,0,Math.PI*2),h.fill();let f=1,E=a*.8,T=this.targetDirection.x*f,m=this.targetDirection.y*f,l=this.targetDirection.x*f,S=this.targetDirection.y*f;h.fillStyle="black",h.beginPath(),h.arc(s+c-r+T,e+r+c+m,E,0,Math.PI*2),h.arc(s+c+r+l,e+r-c+S,E,0,Math.PI*2),h.fill(),h.fillStyle="rgba(250, 250, 250, 0.6)",h.font=`bold ${12*t}px Arial`,h.textAlign="center",h.textBaseline="bottom";let x=this.size*Math.max(1-0/this.segments.length,this.MIN_SEGMENT_SIZE)*t+5;h.fillText(this.name,s,e-x)}h.globalAlpha=1}},N=class{constructor(t=!1){this.size=t?8:4,this.value=t?3:1,this.isFlying=t,this.resetPosition(),this.color=this.isFlying?"gold":"lightgreen",this.shadowColor=this.isFlying?"rgba(255, 215, 0, 0.3)":"rgba(144, 238, 144, 0.3)",this.floatingSpeed=.01,this.floatingAmplitude=.8,this.isFlying&&(this.blinkInterval=500,this.lastBlink=0,this.isFlickering=!1,this.fleeingBlinkInterval=300,this.fleeingLastBlink=0,this.isFleeingFlickering=!1,this.setRandomDirection(),this.baseSpeed=1,this.speed=this.baseSpeed*1.3,this.wobbleInterval=150,this.lastWobble=Date.now(),this.maxWanderDistance=150,this.initialPosition={...this.position})}setRandomDirection(){this.direction={x:Math.random()-.5,y:Math.random()-.5};let t=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=t,this.direction.y/=t}resetPosition(){this.position={x:Math.random()*(_-100)+50,y:Math.random()*(b-100)+50}}update(){if(this.isFlying){if(!this.fleeing){let i=Date.now();i-this.lastWobble>this.wobbleInterval&&(this.setRandomDirection(),this.lastWobble=i)}if(this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.position.x<0&&(this.position.x=_),this.position.x>_&&(this.position.x=0),this.position.y<0&&(this.position.y=b),this.position.y>b&&(this.position.y=0),this.getDistance(this.initialPosition,this.position)>this.maxWanderDistance){let i=this.initialPosition.x-this.position.x,s=this.initialPosition.y-this.position.y,e=Math.sqrt(i*i+s*s);this.direction.x=i/e,this.direction.y=s/e,this.speed=this.baseSpeed}else this.speed=this.baseSpeed*1.3}}getDistance(t,i){let s=t.x-i.x,e=t.y-i.y;return Math.sqrt(s*s+e*e)}flee(t,i){if(this.isFlying&&!this.fleeing){let s=this.position.x-t.x,e=this.position.y-t.y,o=Math.sqrt(s*s+e*e);if(o<70){let a={x:s/o,y:e/o};this.direction=a,this.speed=this.baseSpeed*8,this.fleeing=!0,this.fleeingColor="yellow",this.size=12,setTimeout(()=>{this.speed=this.baseSpeed*1.3,this.fleeing=!1,this.fleeingColor="red",this.size=9},Math.random()*1500+500)}}}draw(){let t=0;if(!this.isFlying){let e=Date.now()*this.floatingSpeed;t=Math.sin(e+this.position.y)*this.floatingAmplitude}let i=this.position.x-p.x,s=this.position.y-p.y+t;if(i>=-10&&i<=B+10&&s>=-10&&s<=C+10&&(this.isFlying||(h.fillStyle=this.shadowColor,h.beginPath(),h.arc(i,s,this.size*1.1,0,Math.PI*2),h.fill()),h.fillStyle=this.color,h.beginPath(),h.arc(i,s,this.size,0,Math.PI*2),h.fill(),this.isFlying)){let e=this.blinkInterval,o=this.isFleeingFlickering?this.isFleeingFlickering:this.isFlickering,a=this.fleeingLastBlink||this.lastBlink,c=this.fleeing?1.4:1.2,r=Date.now();r-a>=e&&(this.fleeing?(this.isFleeingFlickering=!this.isFleeingFlickering,this.fleeingLastBlink=r):(this.isFlickering=!this.isFlickering,this.lastBlink=r)),o&&(h.fillStyle=this.shadowColor,h.beginPath(),h.arc(i,s,this.size*c,0,Math.PI*2),h.fill())}}};function et(){return U[Math.floor(Math.random()*U.length)]}function q(n,t,i){return n+(t-n)*i}function nt(n,t,i){let s=(t-n+360)%360;return s>180&&(s-=360),n+s*i}var p={x:0,y:0,update:function(n,t){let s=n-B/2,e=t-C/2;this.x+=(s-this.x)*.1,this.y+=(e-this.y)*.1}},y=new H(M.width/2,M.height/2,"#4444ff",!1,"Player"),G=[],D=[y];for(let n=0;n<K;n++){let t=Z(Math.random()*M.width,Math.random()*M.height,et(),D);G.push(t),D.push(t)}function Z(n,t,i,s){let e;do e=Y[Math.floor(Math.random()*Y.length)];while(H.isNameTaken(e,s));let o=Math.random()*_,a=Math.random()*b;return new H(o,a,i,!0,e)}var P=Array(J).fill(null).map(()=>new N),ot=9e3;setInterval(()=>{Math.random()<.2&&P.push(new N(!0))},ot);document.addEventListener("mousemove",n=>{if(!y.isAlive||y.isDying)return;let t=n.clientX-M.offsetLeft+p.x,i=n.clientY-M.offsetTop+p.y,s=y.segments[0],e=t-s.x,o=i-s.y,a={x:e,y:o},c=Math.sqrt(a.x*a.x+a.y*a.y);c>0?(a.x/=c,a.y/=c):a={x:1,y:0};let r=.5;y.targetDirection.x=q(y.targetDirection.x,a.x,r),y.targetDirection.y=q(y.targetDirection.y,a.y,r)});document.addEventListener("keydown",n=>{n.code==="Space"&&y.isAlive&&y.canSpeedBoost()&&(y.isSpeedingUp=!0,y.lastSpeedBoostTime=Date.now())});document.addEventListener("keyup",n=>{n.code==="Space"&&(y.isSpeedingUp=!1)});document.addEventListener("mousedown",n=>{n.button===0&&y.isAlive&&y.canSpeedBoost()&&(y.isSpeedingUp=!0)});document.addEventListener("mouseup",n=>{n.button===0&&(y.isSpeedingUp=!1)});function ht(n){let t=null,i=1/0,s=$(n);return st.forEach(e=>{let o=$(e),a=at(s,o);a<i&&(i=a,t=e)}),t}function $(n){let t=parseInt(n.slice(1,3),16),i=parseInt(n.slice(3,5),16),s=parseInt(n.slice(5,7),16);return{r:t,g:i,b:s}}function at(n,t){return Math.sqrt(.3*Math.pow(n.r-t.r,2)+.59*Math.pow(n.g-t.g,2)+.11*Math.pow(n.b-t.b,2))}function rt(){D.forEach(n=>{if(!n.isAlive||n.isDying)return;let t=n.segments[0],i=n.direction;for(let s=P.length-1;s>=0;s--){let e=P[s];e.isFlying&&!e.fleeing&&e.flee(t,i);let o=t.x-e.position.x,a=t.y-e.position.y;if(Math.sqrt(o*o+a*a)<n.size+e.size){P.splice(s,1);let r=Math.random()<.1,f=Date.now();P.length<j&&f-k>=Q&&(P.push(new N(r)),k=f),n.segments.length<n.MAX_LENGTH&&n.grow(e.value),n.foodEaten+=e.value*.2;break}}});for(let n=0;n<D.length;n++){let t=D[n];if(!t.isAlive||t.isDying)continue;let i=t.segments[0];for(let s=0;s<D.length;s++){let e=D[s];if(!(t===e||!e.isAlive||e.isDying))for(let o=0;o<e.segments.length;o++){let a=e.segments[o],c=i.x-a.x,r=i.y-a.y,f=Math.sqrt(c*c+r*r),E=o===0?e.size:e.size*.8;if(f<t.size+E*.7){if(t.lives=Math.max(0,t.lives-1),t.isDying=!0,t.deathProgress=0,t.lives<=0){let T=[...t.segments],m=2.5,l=ht(t.color);T.forEach(g=>{let F=Math.random()*2*Math.PI,A=Math.random()*t.size*m,v=g.x+A*Math.cos(F),O=g.y+A*Math.sin(F),L=new N;L.color=l,L.position={x:v,y:O},P.push(L)});let S=G.indexOf(t);S!==-1&&G.splice(S,1);let x=D.indexOf(t);x!==-1&&D.splice(x,1);let w=Math.random()*M.width,d=Math.random()*M.height,u=Z(w,d,ct(),D);D.push(u),G.push(u)}else console.log(`${t.name} lost a life! Remaining lives: ${t.lives}`);return}}}}}function ct(){let n=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),i=Math.floor(Math.random()*256);return`rgb(${n}, ${t}, ${i})`}function lt(){R.innerHTML=D.map(n=>{let t=n.isAlive&&!n.isDying?"alive":"dead",i="Dead";return n.isAlive?i="Active":n.isDying?i="Dying...":n.lives>0&&(i="Respawning..."),`
          <div class="player-stats ${t}">
            <strong>${n.name}</strong>: 
            ${n.lives} ${n.lives===1?"life":"lives"} | 
            Length: ${n.segments.length}/${n.getCurrentMaxLength()} |
            Status: ${i}
          </div>
        `}).join(""),R.style.position="absolute",R.style.top="10px",R.style.left="10px",R.style.backgroundColor="rgba(255, 255, 255, 0.7)",R.style.fontSize="14px",R.style.padding="5px"}function dt(){I.clearRect(0,0,W.width,W.height);let n=Math.min(W.width/_,W.height/b);P.forEach(c=>{let r=c.position.x*n,f=c.position.y*n;I.fillStyle=c.isFlying?"gold":"lightgreen",I.beginPath(),I.arc(r,f,2,0,Math.PI*2),I.fill()});let t=y.segments[0].x*n,i=y.segments[0].y*n;I.fillStyle=y.color,I.beginPath(),I.arc(t,i,4,0,Math.PI*2),I.fill();let s=p.x*n,e=p.y*n,o=B*n,a=C*n;I.strokeStyle="white",I.lineWidth=1,I.strokeRect(s,e,o,a)}function gt(n){let t=[...D];y.isAlive&&p.update(y.segments[0].x,y.segments[0].y),h.clearRect(0,0,B,C),h.strokeStyle="#FF4444",h.lineWidth=4,h.strokeRect(-p.x,-p.y,_,b),h.strokeStyle="#333333",h.lineWidth=1;let i=100,s=Math.floor(p.x/i)*i,e=Math.floor(p.y/i)*i;for(let o=s;o<p.x+B+i;o+=i)o>=0&&o<=_&&(h.beginPath(),h.moveTo(o-p.x,0),h.lineTo(o-p.x,C),h.stroke());for(let o=e;o<p.y+C+i;o+=i)o>=0&&o<=b&&(h.beginPath(),h.moveTo(0,o-p.y),h.lineTo(B,o-p.y),h.stroke());P.forEach(o=>{o.update(),o.draw()}),t.forEach(o=>{o.update(P,t,n),o.draw()}),rt(),lt()}var V=performance.now();function X(){h.clearRect(0,0,M.width,M.height),dt();let n=performance.now(),t=(n-V)/1e3;t=Math.min(t,1/30),gt(t),y.lives<=0?(h.fillStyle="rgba(0, 0, 0, 0.5)",h.fillRect(0,0,M.width,M.height),h.fillStyle="white",h.font="30px Arial",h.textAlign="center",h.textBaseline="middle",h.fillText("Game Over!",M.width/2,M.height/2),cancelAnimationFrame(X)):(V=n,requestAnimationFrame(X))}X();})();
