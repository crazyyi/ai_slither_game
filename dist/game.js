(()=>{var x=document.getElementById("gameCanvas"),T=x.height*3,A=x.width*3,F=x.width,P=x.height,o=x.getContext("2d"),L=document.getElementById("stats"),z=document.getElementById("radarCanvas"),w=z.getContext("2d");var $=200,U=60,V=5,j=2e3,W=0,G=["Slitherin","Viper","Cobra","Python","Anaconda","Mamba","Asp","Rattler","Boa","Serpent","Sidewinder","Boomslang","Racer","Kingsnake","Coral","Cottonmouth","Copperhead","Harlequin","Gaboon","Moccasin"],k=["#0056b3","#006400","#8B4513","#800000","#4B0082","#2F4F4F","#A0522D","#8B0000","#228B22","#B8860B","#A52A2A","#DC143C","#00008B","#008B8B","#B22222","#FF4500","#9932CC","#8FBC8F","#282c34","#003f5c","#58508d","#bc5090","#ff6361","#ffa60a","#ffd700","#008000","#006400","#228B22","#008080","#4682B4","#2F4F4F","#708090","#8B0000","#A0522D","#8B4513","#4B0082","#9400D3","#00008B"],X=class{static isNameTaken(t,e){return e.some(s=>s.name===t&&s.isAlive&&!s.isDying)}constructor(t,e,s,i=!1,a="Player"){this.color=s,this.isBot=i,this.name=a,this.SAFE_SPAWN_DISTANCE=70,this.RESPAWN_TIME=180,this.MIN_SEGMENT_SIZE=1.5,this.BASE_LENGTH=50,this.MAX_LENGTH=Math.floor(this.BASE_LENGTH*2.5),this.GROWTH_RATE=.2,this.SPEED_BOOST_COST=2,this.BASE_SPEED=1.6,this.SPEED_BOOST=1.5,this.reset(t,e),this.size=6,this.lives=3,this.isAlive=!0,this.respawnTimer=0,this.targetPoint=null,this.opacity=1,this.isDying=!1,this.deathProgress=0,this.foodEaten=0,this.baseSpeed=this.BASE_SPEED,this.speed=this.baseSpeed,this.speedBoost=1.5,this.isSpeedingUp=!1,this.speedBoostCost=2,this.lastSpeedBoostTime=0,this.lastLengthChangeTime=0,this.cursorX=0,this.cursorY=0,this.trail=[],this.trailMaxLength=25}reset(t,e){this.segments=[{x:t,y:e}],this.direction={x:1,y:0},this.isAlive=!0,this.opacity=1,this.isDying=!1,this.deathProgress=0}getCurrentMaxLength(){let t=this.MAX_LENGTH-this.BASE_LENGTH,e=Math.min(t*this.foodEaten*this.GROWTH_RATE,t);return Math.floor(this.BASE_LENGTH+e)}grow(){this.foodEaten+=.2;let t={...this.segments[this.segments.length-1]};this.segments.push(t)}update(t,e){let s=this.getCurrentMaxLength();if(this.isSpeedingUp){if(this.segments.length<=this.BASE_LENGTH){this.isSpeedingUp=!1,this.speed=this.baseSpeed;return}let h=Date.now();if(this.lastShrinkTime||(this.lastShrinkTime=h),h-this.lastShrinkTime>=200){if(this.segments.length>this.BASE_LENGTH){let l=this.segments.pop();if(l){let E=l.x+(Math.random()-.5)*10,b=l.y+(Math.random()-.5)*10,u=new C;u.position={x:E,y:b},t.push(u),this.foodEaten=Math.max(0,this.foodEaten-.2)}}else this.isSpeedingUp=!1;this.lastShrinkTime=h}this.speed=this.baseSpeed*this.SPEED_BOOST}else this.lastShrinkTime=null,this.speed=this.baseSpeed;if(this.isDying){this.deathProgress+=.02,this.opacity=Math.max(0,1-this.deathProgress),this.deathProgress>=1&&(this.isDying=!1,this.isAlive=!1,this.lives>0&&(this.respawnTimer=this.RESPAWN_TIME));return}if(!this.isAlive){if(this.lives<=0)return;this.respawnTimer--,this.respawnTimer<=0&&this.respawn();return}this.isBot&&this.updateAI(t,e);let i=this.segments[0],a={x:i.x+this.direction.x*this.speed,y:i.y+this.direction.y*this.speed};for(a.x<0&&(a.x=A),a.x>A&&(a.x=0),a.y<0&&(a.y=T),a.y>T&&(a.y=0),this.segments.unshift(a),this.isSpeedingUp?(this.trail.push({x:a.x,y:a.y}),this.trail.length>this.trailMaxLength&&this.trail.shift()):this.trail=[];this.segments.length>s;)this.segments.pop()}canSpeedBoost(){return this.segments.length>this.BASE_LENGTH}updateAI(t,e){let s=this.segments[0],i=null,a=1/0;t.forEach(c=>{if(c.isFlying){let y=this.getDistance(s,c.position);y<a&&(a=y,i=c)}else if(!this.isChasingFlyingFood){let y=this.getDistance(s,c.position);y<a&&(a=y,i=c)}});let h=i?i.position:null,r=1/0,l=0,d={x:0,y:0};if(e.forEach(c=>{if(c!==this&&c.isAlive&&!c.isDying){let S={...c.segments[0]};for(let p=0;p<10;p++){S.x+=c.direction.x*20,S.y+=c.direction.y*20;let m=this.getDistance(s,S);if(m<r){r=m;let v=S.x-s.x,B=S.y-s.y,_=c.size*3;h={x:S.x+v*_/m,y:S.y+B*_/m}}l+=Math.max(0,100-m)}for(let p of c.segments){let m=this.getDistance(s,p);if(m<this.size*2){let N=s.x-p.x,R=s.y-p.y,O={x:N/m,y:R/m};d.x+=O.x*10,d.y+=O.y*10}let v=p.x+c.direction.x*10,B=p.y+c.direction.y*10,_=this.getDistance(s,{x:v,y:B});if(_<this.size*4){let N=s.x-v,R=s.y-B,O={x:N/_,y:R/_};d.x+=O.x*5,d.y+=O.y*5}}}}),h){h.x+=d.x,h.y+=d.y;let c=50,y=Math.random()*Math.PI*2;h.x+=Math.cos(y)*c,h.y+=Math.sin(y)*c;let S=.3;h.x+=(Math.random()-.5)*S,h.y+=(Math.random()-.5)*S;let p=h.x-s.x,m=h.y-s.y,v=Math.sqrt(p*p+m*m);v>0&&(h.x=s.x+p/v*100,h.y=s.y+m/v*100)}else{this.direction.x+=d.x*.1,this.direction.y+=d.y*.1;let c=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=c,this.direction.y/=c,this.speed=this.baseSpeed;return}i&&i.isFlying?this.isChasingFlyingFood=!0:this.isChasingFlyingFood=!1;let E=h.x-s.x,b=h.y-s.y,u={x:E,y:b},I=Math.sqrt(u.x*u.x+u.y*u.y);if(I>0){u.x/=I,u.y/=I;let c=.1;this.direction.x=this.direction.x*(1-c)+u.x*c,this.direction.y=this.direction.y*(1-c)+u.y*c;let y=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=y,this.direction.y/=y}}getDistance(t,e){let s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}respawn(){if(this.lives>0){let t=this.findSafeSpawnPosition();this.reset(t.x,t.y),this.targetPoint=null}}findSafeSpawnPosition(){let t=0,e;do e={x:Math.random()*(A-100)+50,y:Math.random()*(T-100)+50},t++;while(this.isPositionNearSnakes(e)&&t<10);return e}isPositionNearSnakes(t){return M.some(e=>e===this||!e.isAlive||e.isDying?!1:this.getDistance(t,e.segments[0])<this.SAFE_SPAWN_DISTANCE)}draw(){if(!this.isAlive&&!this.isDying)return;let t=1.6;o.globalAlpha=this.opacity,this.isSpeedingUp&&this.trail.forEach((a,h)=>{let r=a.x-f.x,l=a.y-f.y;if(r>=-10&&r<=F+10&&l>=-10&&l<=P+10){let d=(h+1)/this.trail.length*.5,E=d*.3;o.fillStyle=`rgba(255, 190, 0, ${E})`,o.beginPath(),o.arc(r,l,this.size*(1.4-h/this.trail.length/3)*t,0,Math.PI*2),o.fill(),o.fillStyle=`rgba(255, 153, 0, ${d})`,o.beginPath(),o.arc(r,l,this.size*(1.2-h/this.trail.length/3)*t,0,Math.PI*2),o.fill()}}),o.fillStyle=this.color,this.segments.forEach((a,h)=>{let r=a.x-f.x,l=a.y-f.y;if(r>=-10&&r<=F+10&&l>=-10&&l<=P+10){let E=Math.max(this.size*(1-h/this.segments.length),this.MIN_SEGMENT_SIZE)*t;o.beginPath(),o.arc(r,l,E,0,Math.PI*2),o.fill()}});let e=this.segments[0],s=e.x-f.x,i=e.y-f.y;if(s>=-10&&s<=F+10&&i>=-10&&i<=P+10){o.fillStyle="white";let a=2*t,h=1.5*t,r=this.direction.x*a,l=this.direction.y*a;o.beginPath(),o.arc(s+r-l,i+l+r,h,0,Math.PI*2),o.arc(s+r+l,i+l-r,h,0,Math.PI*2),o.fill();let d=h*.8,E=this.cursorX-(s+r-l),b=this.cursorY-(i+l+r),u=Math.sqrt(E*E+b*b),I=E/u*(h-d),c=b/u*(h-d),y=this.cursorX-(s+r+l),S=this.cursorY-(i+l-r),p=Math.sqrt(y*y+S*S),m=y/p*(h-d),v=S/p*(h-d);o.fillStyle="black",o.beginPath(),o.arc(s+r-l+I,i+l+r+c,d,0,Math.PI*2),o.arc(s+r+l+m,i+l-r+v,d,0,Math.PI*2),o.fill(),o.fillStyle="rgba(250, 250, 250, 0.6)",o.font=`bold ${12*t}px Arial`,o.textAlign="center",o.textBaseline="bottom";let B=this.size*Math.max(1-0/this.segments.length,this.MIN_SEGMENT_SIZE)*t+5;o.fillText(this.name,s,i-B)}o.globalAlpha=1}},C=class{constructor(t=!1){this.size=t?8:4,this.value=t?3:1,this.isFlying=t,this.resetPosition(),this.color=this.isFlying?"gold":"lightgreen",this.shadowColor=this.isFlying?"rgba(255, 215, 0, 0.3)":"rgba(144, 238, 144, 0.3)",this.isFlying&&(this.blinkInterval=500,this.lastBlink=0,this.isFlickering=!1,this.fleeingBlinkInterval=300,this.fleeingLastBlink=0,this.isFleeingFlickering=!1,this.setRandomDirection(),this.baseSpeed=1,this.speed=this.baseSpeed*1.3,this.wobbleInterval=150,this.lastWobble=Date.now(),this.maxWanderDistance=150,this.initialPosition={...this.position})}setRandomDirection(){this.direction={x:Math.random()-.5,y:Math.random()-.5};let t=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=t,this.direction.y/=t}resetPosition(){this.position={x:Math.random()*(A-100)+50,y:Math.random()*(T-100)+50}}update(){if(this.isFlying){if(!this.fleeing){let e=Date.now();e-this.lastWobble>this.wobbleInterval&&(this.setRandomDirection(),this.lastWobble=e)}if(this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.position.x<0&&(this.position.x=A),this.position.x>A&&(this.position.x=0),this.position.y<0&&(this.position.y=T),this.position.y>T&&(this.position.y=0),this.getDistance(this.initialPosition,this.position)>this.maxWanderDistance){let e=this.initialPosition.x-this.position.x,s=this.initialPosition.y-this.position.y,i=Math.sqrt(e*e+s*s);this.direction.x=e/i,this.direction.y=s/i,this.speed=this.baseSpeed}else this.speed=this.baseSpeed*1.3}}getDistance(t,e){let s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}flee(t,e){if(this.isFlying&&!this.fleeing){let s=this.position.x-t.x,i=this.position.y-t.y,a=Math.sqrt(s*s+i*i);if(a<70){let h={x:s/a,y:i/a};this.direction=h,this.speed=this.baseSpeed*8,this.fleeing=!0,this.fleeingColor="yellow",this.size=12,setTimeout(()=>{this.speed=this.baseSpeed*1.3,this.fleeing=!1,this.fleeingColor="red",this.size=9},Math.random()*1500+500)}}}draw(){let t=this.position.x-f.x,e=this.position.y-f.y;if(t>=-10&&t<=F+10&&e>=-10&&e<=P+10&&(o.fillStyle=this.color,o.beginPath(),o.arc(t,e,this.size,0,Math.PI*2),o.fill(),this.isFlying)){let s=this.blinkInterval,i=this.isFleeingFlickering?this.isFleeingFlickering:this.isFlickering,a=this.fleeingLastBlink||this.lastBlink,h=this.fleeing?1.4:1.2,r=Date.now();r-a>=s&&(this.fleeing?(this.isFleeingFlickering=!this.isFleeingFlickering,this.fleeingLastBlink=r):(this.isFlickering=!this.isFlickering,this.lastBlink=r)),i&&(o.fillStyle=this.shadowColor,o.beginPath(),o.arc(t,e,this.size*h,0,Math.PI*2),o.fill())}}};function Z(){return k[Math.floor(Math.random()*k.length)]}var f={x:0,y:0,update:function(n,t){let s=n-F/2,i=t-P/2;this.x+=(s-this.x)*.1,this.y+=(i-this.y)*.1}},g=new X(x.width/2,x.height/2,"#4444ff",!1,"Player"),H=[],M=[g];for(let n=0;n<V;n++){let t=q(Math.random()*x.width,Math.random()*x.height,Z(),M);H.push(t),M.push(t)}function q(n,t,e,s){let i;do i=G[Math.floor(Math.random()*G.length)];while(X.isNameTaken(i,s));let a=Math.random()*A,h=Math.random()*T;return new X(a,h,e,!0,i)}var D=Array(U).fill(null).map(()=>new C),K=9e3;setInterval(()=>{Math.random()<.2&&D.push(new C(!0))},K);document.addEventListener("mousemove",n=>{if(!g.isAlive||g.isDying)return;let t=x.getBoundingClientRect(),e=n.clientX-t.left+f.x,s=n.clientY-t.top+f.y,i=g.segments[0],a=e-i.x,h=s-i.y,r=Math.sqrt(a*a+h*h);r>0&&(g.direction.x=a/r,g.direction.y=h/r),g.cursorX=n.clientX-t.left,g.cursorY=n.clientY-t.top});document.addEventListener("keydown",n=>{n.code==="Space"&&g.isAlive&&g.canSpeedBoost()&&(g.isSpeedingUp=!0,g.lastSpeedBoostTime=Date.now())});document.addEventListener("keyup",n=>{n.code==="Space"&&(g.isSpeedingUp=!1)});document.addEventListener("mousedown",n=>{n.button===0&&g.isAlive&&g.canSpeedBoost()&&(g.isSpeedingUp=!0)});document.addEventListener("mouseup",n=>{n.button===0&&(g.isSpeedingUp=!1)});function J(){M.forEach(n=>{if(!n.isAlive||n.isDying)return;let t=n.segments[0],e=n.direction;for(let s=D.length-1;s>=0;s--){let i=D[s];i.isFlying&&!i.fleeing&&i.flee(t,e);let a=t.x-i.position.x,h=t.y-i.position.y;if(Math.sqrt(a*a+h*h)<n.size+i.size){D.splice(s,1);let l=Math.random()<.1,d=Date.now();D.length<$&&d-W>=j&&(D.push(new C(l)),W=d),n.segments.length<n.MAX_LENGTH&&n.grow(),n.foodEaten+=i.value*.2;break}}});for(let n=0;n<M.length;n++){let t=M[n];if(!t.isAlive||t.isDying)continue;let e=t.segments[0];for(let s=0;s<M.length;s++){let i=M[s];if(!(t===i||!i.isAlive||i.isDying))for(let a=0;a<i.segments.length;a++){let h=i.segments[a],r=e.x-h.x,l=e.y-h.y,d=Math.sqrt(r*r+l*l),E=a===0?i.size:i.size*.8;if(d<t.size+E*.7){if(t.lives=Math.max(0,t.lives-1),t.isDying=!0,t.deathProgress=0,t.lives<=0){console.log(`${t.name} is out of lives!`);let b=[...t.segments],u=2.5;b.forEach(m=>{let v=Math.random()*2*Math.PI,B=Math.random()*t.size*u,_=m.x+B*Math.cos(v),N=m.y+B*Math.sin(v),R=new C;R.position={x:_,y:N},D.push(R)});let I=H.indexOf(t);I!==-1&&H.splice(I,1);let c=M.indexOf(t);c!==-1&&M.splice(c,1);let y=Math.random()*x.width,S=Math.random()*x.height,p=q(y,S,Q(),M);M.push(p),H.push(p)}else console.log(`${t.name} lost a life! Remaining lives: ${t.lives}`);return}}}}}function Q(){let n=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),e=Math.floor(Math.random()*256);return`rgb(${n}, ${t}, ${e})`}function tt(){L.innerHTML=M.map(n=>{let t=n.isAlive&&!n.isDying?"alive":"dead",e="Dead";return n.isAlive?e="Active":n.isDying?e="Dying...":n.lives>0&&(e="Respawning..."),`
          <div class="player-stats ${t}">
            <strong>${n.name}</strong>: 
            ${n.lives} ${n.lives===1?"life":"lives"} | 
            Length: ${n.segments.length}/${n.getCurrentMaxLength()} |
            Status: ${e}
          </div>
        `}).join(""),L.style.position="absolute",L.style.top="10px",L.style.left="10px",L.style.backgroundColor="rgba(255, 255, 255, 0.7)",L.style.fontSize="14px",L.style.padding="5px"}function it(){w.clearRect(0,0,z.width,z.height);let n=Math.min(z.width/A,z.height/T);D.forEach(r=>{let l=r.position.x*n,d=r.position.y*n;w.fillStyle=r.isFlying?"gold":"lightgreen",w.beginPath(),w.arc(l,d,2,0,Math.PI*2),w.fill()});let t=g.segments[0].x*n,e=g.segments[0].y*n;w.fillStyle=g.color,w.beginPath(),w.arc(t,e,4,0,Math.PI*2),w.fill();let s=f.x*n,i=f.y*n,a=F*n,h=P*n;w.strokeStyle="white",w.lineWidth=1,w.strokeRect(s,i,a,h)}function st(){let n=[...M];g.isAlive&&f.update(g.segments[0].x,g.segments[0].y),o.clearRect(0,0,F,P),o.strokeStyle="#FF4444",o.lineWidth=4,o.strokeRect(-f.x,-f.y,A,T),o.strokeStyle="#333333",o.lineWidth=1;let t=100,e=Math.floor(f.x/t)*t,s=Math.floor(f.y/t)*t;for(let i=e;i<f.x+F+t;i+=t)i>=0&&i<=A&&(o.beginPath(),o.moveTo(i-f.x,0),o.lineTo(i-f.x,P),o.stroke());for(let i=s;i<f.y+P+t;i+=t)i>=0&&i<=T&&(o.beginPath(),o.moveTo(0,i-f.y),o.lineTo(F,i-f.y),o.stroke());D.forEach(i=>{i.update(),i.draw()}),n.forEach(i=>{i.update(D,n),i.draw()}),J(),tt()}function Y(){o.clearRect(0,0,x.width,x.height),it(),st(),g.lives<=0?(o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(0,0,x.width,x.height),o.fillStyle="white",o.font="30px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText("Game Over!",x.width/2,x.height/2),cancelAnimationFrame(Y)):requestAnimationFrame(Y)}Y();})();
