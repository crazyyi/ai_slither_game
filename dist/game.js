(()=>{var A=document.getElementById("gameCanvas"),T=A.height*4,w=A.width*4,b=A.width,v=A.height,e=A.getContext("2d"),_=document.getElementById("stats"),O=document.getElementById("radarCanvas"),F=O.getContext("2d");var Q=1e3,J=360,tt=7,it=1100,B=[80,160,240,320,400],L=350,q=0,st=["#FF0000","#90EE90","#0000FF","#FFFF00","#FFA500","#800080","#00FFFF","#FF69B4","#FFD700","#ADFF2F","#FF4500","#1E90FF"],U=["Slither","Coil","Wiggle","Zigzag","Slink","Curve","Loop","Spiral","Twist","Turn","Wind","Weave","Dart","Dash","Streak","Flash","Glide","Sweep","Dive","Soar","Creep","Crawl","Skulk","Prowl","Lurk","Sneak","Slide","Slip","Shimmy","Wobble","Undulate","Meander","Serpent","Viper","Python","Cobra","Mamba","Asp","Krait","Taipan"],Y=["#FF69B4","#FFD700","#00FF00","#00FFFF","#FF00FF","#ADFF2F","#FFA500","#FFB6C1","#FFFF00","#00CED1","#90EE90","#FF7F50","#FF6347","#7CFC00","#AFEEEE","#F0E68C","#FFFAFA","#DA70D6","#DB7093","#FFC0CB","#FFEFD5","#FFA07A","#98FB98","#FFB347","#FFFFE0"],W={USE_DUAL_COLORS:!0,PLAYER_DUAL_COLOR_CHANCE:1,BOT_DUAL_COLOR_CHANCE:.5},P={turningSpeed:.15,turningSpeedMultiplier:1,directionSmoothing:.1,minSegmentDistance:2,maxSegmentDistance:2.2,smoothingStrength:.1,damping:.8,turnTighteningFactor:.3,maxBendAngle:45},R=class a{static FOOD_DETECTION_RANGE=200;static SNAKE_TARGET_RANGE=300;static MIN_SNAKE_SIZE_TO_CHASE=.85;static AVOIDANCE_WEIGHT=2;static RANDOM_EXPLORATION_WEIGHT=.2;static isNameTaken(t,i){return i.some(s=>s.name===t&&s.isAlive&&!s.isDying)}constructor(t,i,s,n=!1,h="Player"){this.color=s,this.isBot=n,this.name=h,this.useDualColors=W.USE_DUAL_COLORS&&this.shouldUseDualColors(),this.secondaryColor=this.useDualColors?this.generateSecondaryColor(s):s,this.SAFE_SPAWN_DISTANCE=80,this.RESPAWN_TIME=180,this.MIN_SEGMENT_SIZE=1.5,this.BASE_LENGTH=30,this.MAX_LENGTH=Math.floor(this.BASE_LENGTH*14),this.GROWTH_RATE=.01,this.SPEED_BOOST_COST=2,this.BASE_SPEED=160,this.SPEED_BOOST=1.5,this.x=t,this.y=i,this.segments=[],n&&this.reset(t,i),this.size=6,this.lives=1,this.isAlive=!0,this.respawnTimer=0,this.targetPoint=null,this.opacity=1,this.isDying=!1,this.deathProgress=0,this.foodEaten=0,this.MAX_FOOD_EATEN_FOR_SEGMENT=30,this.growthProgress=0,this.baseSpeed=this.BASE_SPEED,this.speed=this.baseSpeed,this.speedBoost=1.5,this.isSpeedingUp=!1,this.speedBoostCost=2,this.lastSpeedBoostTime=0,this.lastLengthChangeTime=0,this.cursorX=0,this.cursorY=0,this.trail=[],this.targetDirection={...this.direction},this.turningSpeed=P.turningSpeed,this.turningSpeedMultiplier=P.turningSpeedMultiplier,this.directionSmoothing=P.directionSmoothing,this.minSegmentDistance=P.minSegmentDistance,this.maxSegmentDistance=P.maxSegmentDistance,this.smoothingStrength=P.smoothingStrength,this.damping=P.damping,this.turnTighteningFactor=P.turnTighteningFactor,this.maxBendAngle=P.maxBendAngle}reset(t,i){this.x=t,this.y=i,this.segments=[],this.segments.push({x:t,y:i});let s=Math.random()*2*Math.PI;this.direction={x:Math.cos(s),y:Math.sin(s)},this.targetDirection={...this.direction},this.isAlive=!0,this.opacity=1,this.isDying=!1,this.deathProgress=0}shouldUseDualColors(){let t=this.isBot?W.BOT_DUAL_COLOR_CHANCE:W.PLAYER_DUAL_COLOR_CHANCE;return Math.random()<t}getCurrentMaxLength(){let t=this.MAX_LENGTH-this.BASE_LENGTH,i=Math.min(t*this.foodEaten*this.GROWTH_RATE,t);return Math.floor(this.BASE_LENGTH+i)}grow(t){let s=1+this.segments.length/11;s=Math.min(s,this.MAX_FOOD_EATEN_FOR_SEGMENT);let n=t/s;this.growthProgress+=n,this.growthProgress>=1&&(this.growthProgress-=1,this.segments.push({...this.segments[this.segments.length-1]})),this.foodEaten+=n}update(t,i,s){this.updatedScale=(()=>{for(let g=B.length-1;g>=0;g--)if(this.segments.length>B[g])return 1.6+g*.4;return 1.6})();let n=this.getCurrentMaxLength();if(this.isSpeedingUp){if(this.segments.length<=this.BASE_LENGTH){this.isSpeedingUp=!1,this.speed=this.baseSpeed;return}let g=Date.now();if(this.lastShrinkTime||(this.lastShrinkTime=g),g-this.lastShrinkTime>=200){if(this.segments.length>this.BASE_LENGTH){let f=this.segments.pop();if(f){let u=f.x+(Math.random()-.5)*10,D=f.y+(Math.random()-.5)*10,M=new N;M.position={x:u,y:D},t.push(M),this.foodEaten=Math.max(0,this.foodEaten-.2)}}else this.isSpeedingUp=!1;this.lastShrinkTime=g}this.speed=this.baseSpeed*this.SPEED_BOOST}else this.lastShrinkTime=null,this.speed=this.baseSpeed;if(this.isDying){this.deathProgress+=.02,this.opacity=Math.max(0,1-this.deathProgress),this.deathProgress>=1&&(this.isDying=!1,this.isAlive=!1,this.lives>0&&(this.respawnTimer=this.RESPAWN_TIME));return}if(!this.isAlive){if(this.lives<=0)return;this.respawnTimer--,this.respawnTimer<=0&&this.respawn();return}this.isBot&&this.updateAI(t,i);let h=Math.atan2(this.direction.y,this.direction.x)*180/Math.PI,o=Math.atan2(this.targetDirection.y,this.targetDirection.x)*180/Math.PI,l=et(h,o,this.turningSpeed*s*this.turningSpeedMultiplier);this.direction.x=Math.cos(l*Math.PI/180),this.direction.y=Math.sin(l*Math.PI/180);let r=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);if(r===0?this.direction={x:1,y:0}:(this.direction.x/=r,this.direction.y/=r),this.targetDirection){let g=this.directionSmoothing,m=Math.atan2(this.direction.y,this.direction.x),p=Math.atan2(this.targetDirection.y,this.targetDirection.x)-m;for(;p>Math.PI;)p-=Math.PI*2;for(;p<-Math.PI;)p+=Math.PI*2;let u=m+p*g;this.direction.x=Math.cos(u),this.direction.y=Math.sin(u)}let c=this.segments[0],y=this.speed*s,d={x:c.x+this.direction.x*y,y:c.y+this.direction.y*y};this.segments.unshift(d),this.applySegmentSmoothing(s),this.isSpeedingUp?this.trail.push({x:d.x,y:d.y}):this.trail=[];for(let g=1;g<this.segments.length;g++){let m=this.segments[g-1],f=this.segments[g],p=m.x-f.x,u=m.y-f.y,D=Math.sqrt(p*p+u*u),M=Math.abs(this.targetDirection.x-this.direction.x)+Math.abs(this.targetDirection.y-this.direction.y),C=this.size*(3-this.turnTighteningFactor*M);if(D>C){let X=this.size*(1.5+M)/D;f.x=m.x-p*X,f.y=m.y-u*X}}for(;this.segments.length>n;)this.segments.pop()}applySegmentSmoothing(t){let i=this.size*this.minSegmentDistance,s=this.size*this.maxSegmentDistance,n=this.smoothingStrength;for(let h=1;h<this.segments.length;h++){let o=this.segments[h-1],l=this.segments[h],r=o.x-l.x,c=o.y-l.y,y=Math.sqrt(r*r+c*c);if(y<i)continue;let d=r/y,g=c/y,m=i,f=Math.abs(this.targetDirection.x-this.direction.x+this.targetDirection.y-this.direction.y);m-=f*this.size*.3;let p=o.x-d*m,u=o.y-g*m;l.vx||(l.vx=0),l.vy||(l.vy=0);let D=Math.min(y/s,1),M=n*(1+D);l.vx+=(p-l.x)*M,l.vy+=(u-l.y)*M;let C=this.damping;l.vx*=C,l.vy*=C,l.x+=l.vx*t,l.y+=l.vy*t,y>s&&(l.x=o.x-d*s,l.y=o.y-g*s,l.vx=0,l.vy=0)}}calculateBendAngle(t){let i=this.segments[t-1],s=this.segments[t],n=s.x-i.x,h=s.y-i.y;return Math.atan2(h,n)*(180/Math.PI)}applyBend(t,i){let s=Math.min(Math.max(i,-this.maxBendAngle),this.maxBendAngle);t.x+=Math.cos(s*Math.PI/180)*this.size*.05,t.y+=Math.sin(s*Math.PI/180)*this.size*.05}canSpeedBoost(){return this.segments.length>this.BASE_LENGTH}updateAI(t,i){let s=this.segments[0],n=this.calculateAvoidanceForce(s,i),h=this.determineTargetDirection(s,t,i,n);this.applyMovement(h)}calculateAvoidanceForce(t,i){let s={x:0,y:0};i.forEach(h=>{if(h!==this&&h.isAlive&&!h.isDying){let o=h.segments[0],l=o.x-t.x,r=o.y-t.y,c=Math.sqrt(l*l+r*r),y=this.size*3;if(c<y){let d=(1-c/y)*a.AVOIDANCE_WEIGHT;s.x-=l/c*d,s.y-=r/c*d}}});let n=Math.sqrt(s.x*s.x+s.y*s.y);return n>0&&(s.x/=n,s.y/=n),s}determineTargetDirection(t,i,s,n){let h=null,o=1/0,l=null,r=1/0,c=null,y=1/0;i.forEach(f=>{let p=f.position.x-t.x,u=f.position.y-t.y,D=Math.sqrt(p*p+u*u);D<o&&(o=D,h=f)}),s.forEach(f=>{if(f!==this&&f.isAlive&&!f.isDying){let p=f.segments[0],u=p.x-t.x,D=p.y-t.y,M=Math.sqrt(u*u+D*D),C=f.segments.length/this.segments.length;C>1.2&&M<a.SNAKE_TARGET_RANGE*1.5?M<y&&(y=M,c=f):C<a.MIN_SNAKE_SIZE_TO_CHASE&&M<a.SNAKE_TARGET_RANGE&&M<r&&(r=M,l=f)}});let d=this.direction.x,g=this.direction.y;if(c){let f=t.x-c.segments[0].x,p=t.y-c.segments[0].y,u=Math.sqrt(f*f+p*p);d=f/u+n.x,g=p/u+n.y}else if(l&&Math.random()<.7)d=(l.segments[0].x-t.x)/r+n.x,g=(l.segments[0].y-t.y)/r+n.y;else if(h)d=(h.position.x-t.x)/o+n.x,g=(h.position.y-t.y)/o+n.y;else{let f=Date.now()*.001;d=Math.cos(f*.5)*(1-a.RANDOM_EXPLORATION_WEIGHT)+n.x*a.RANDOM_EXPLORATION_WEIGHT,g=Math.sin(f*.7)*(1-a.RANDOM_EXPLORATION_WEIGHT)+n.y*a.RANDOM_EXPLORATION_WEIGHT}let m=Math.sqrt(d*d+g*g);return m>0?{x:d/m,y:g/m}:{x:0,y:0}}applyMovement(t){this.direction.x=this.direction.x*(1-.1)+t.x*.1,this.direction.y=this.direction.y*(1-.1)+t.y*.1;let s=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=s,this.direction.y/=s}getDistance(t,i){let s=t.x-i.x,n=t.y-i.y;return Math.sqrt(s*s+n*n)}respawn(){if(this.lives>0){let t=this.findSafeSpawnPosition();this.reset(t.x,t.y),this.targetPoint=null}}findSafeSpawnPosition(){let i=this.SAFE_SPAWN_DISTANCE*this.SAFE_SPAWN_DISTANCE;for(let s=0;s<20;s++){let n=Math.floor(Math.random()*(w-2*L))+L,h=Math.floor(Math.random()*(T-2*L))+L;if(!this.isPositionNearSnakes(n,h,i))return{x:n,y:h}}return{x:w/2,y:T/2}}isPositionNearSnakes(t,i,s){if(E.length===0)return!1;for(let n of E){if(n===this||!n.isAlive||n.isDying)continue;let h=t-n.segments[0].x,o=i-n.segments[0].y;if(h*h+o*o<s)return!0}return!1}generateSecondaryColor(t){if(Math.random()<.5){let i,s,n;if(t.startsWith("#")){let r=t.substring(1);i=parseInt(r.substring(0,2),16),s=parseInt(r.substring(2,4),16),n=parseInt(r.substring(4,6),16)}else if(t.startsWith("rgb"))[i,s,n]=t.match(/\d+/g).map(Number);else return H();let h=255-i,o=255-s,l=255-n;return`rgb(${h}, ${o}, ${l})`}else return H()}draw(){if(!this.isAlive&&!this.isDying)return;let t=1.6,i=1;for(let o=B.length-1;o>=0;o--)if(this.segments.length>B[o]){i=(1.6+o*.4)/1.6;break}if(e.globalAlpha=this.opacity,this.isSpeedingUp)for(let o=0;o<this.segments.length;o++){let l=this.segments[o],r=l.x-S.x,c=l.y-S.y;if(r>=-10&&r<=b+10&&c>=-10&&c<=v+10){let y=(o+1)/this.trail.length*.7,d=y*.5;e.fillStyle=`rgba(255, 215, 0, ${d})`,e.shadowColor="yellow",e.shadowBlur=10*i,e.beginPath();let g=Math.max(0,this.size*(1.6-o/this.trail.length/3))*t*i;e.arc(r,c,g,0,Math.PI*2),e.fill(),e.shadowColor="transparent",e.shadowBlur=0,e.fillStyle=`rgba(255, 170, 0, ${y})`,e.beginPath();let m=Math.max(0,this.size*(1.4-o/this.trail.length/3))*t*i;e.arc(r,c,m,0,Math.PI*2),e.fill()}}e.fillStyle=this.color;for(let o=this.segments.length-1;o>=0;o--){let l=this.segments[o],r=l.x-S.x,c=l.y-S.y;if(r>=-10&&r<=b+10&&c>=-10&&c<=v+10){let d=this.size*this.updatedScale;if(o===0){let g=this.direction.x*this.targetDirection.x+this.direction.y*this.targetDirection.y,m=Math.max(.3,g);d*=m}e.fillStyle=this.useDualColors&&Math.floor(o/10)%2===0?this.color:this.secondaryColor,e.beginPath(),e.arc(r,c,d,0,Math.PI*2),e.fill()}}let s=this.segments[0],n=s.x-S.x,h=s.y-S.y;if(n>=-10&&n<=b+10&&h>=-10&&h<=v+10){let o=this.updatedScale/t,l=this.updatedScale/t;e.fillStyle="white";let r=2*t*o,c=1.5*t*o,y=this.direction.x*r,d=this.direction.y*r;e.beginPath(),e.arc(n+y-d,h+d+y,c,0,Math.PI*2),e.arc(n+y+d,h+d-y,c,0,Math.PI*2),e.fill();let g=.9*l,m=c*.8,f=this.targetDirection.x*g,p=this.targetDirection.y*g,u=this.targetDirection.x*g,D=this.targetDirection.y*g;e.fillStyle="black",e.beginPath(),e.arc(n+y-d+f,h+d+y+p,m,0,Math.PI*2),e.arc(n+y+d+u,h+d-y+D,m,0,Math.PI*2),e.fill(),e.fillStyle="rgba(250, 250, 250, 0.6)",e.font=`bold ${12*t}px Arial`,e.textAlign="center",e.textBaseline="bottom";let M=this.size*Math.max(1-0/this.segments.length,this.MIN_SEGMENT_SIZE)*t+5;e.fillText(this.name,n,h-M)}e.globalAlpha=1}},N=class{constructor(t=!1){this.size=t?8:4,this.value=t?3:1,this.isFlying=t,this.resetPosition(),this.color=this.isFlying?"gold":"lightgreen",this.shadowColor=this.isFlying?"rgba(255, 215, 0, 0.3)":"rgba(144, 238, 144, 0.3)",this.floatingSpeed=.01,this.floatingAmplitude=.8,this.isFlying&&(this.blinkInterval=500,this.lastBlink=0,this.isFlickering=!1,this.fleeingBlinkInterval=300,this.fleeingLastBlink=0,this.setRandomDirection(),this.baseSpeed=1,this.speed=this.baseSpeed*1.3,this.wobbleInterval=150,this.lastWobble=Date.now(),this.maxWanderDistance=150,this.initialPosition={...this.position})}setRandomDirection(){this.direction={x:Math.random()-.5,y:Math.random()-.5};let t=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=t,this.direction.y/=t}resetPosition(){this.position={x:Math.random()*(w-100)+50,y:Math.random()*(T-100)+50}}update(){if(this.isFlying){if(!this.fleeing){let i=Date.now();i-this.lastWobble>this.wobbleInterval&&(this.setRandomDirection(),this.lastWobble=i)}if(this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.position.x<0&&(this.position.x=w),this.position.x>w&&(this.position.x=0),this.position.y<0&&(this.position.y=T),this.position.y>T&&(this.position.y=0),this.getDistance(this.initialPosition,this.position)>this.maxWanderDistance){let i=this.initialPosition.x-this.position.x,s=this.initialPosition.y-this.position.y,n=Math.sqrt(i*i+s*s);this.direction.x=i/n,this.direction.y=s/n,this.speed=this.baseSpeed}else this.speed=this.baseSpeed*1.3}}getDistance(t,i){let s=t.x-i.x,n=t.y-i.y;return Math.sqrt(s*s+n*n)}flee(t,i){if(this.isFlying&&!this.fleeing){let s=this.position.x-t.x,n=this.position.y-t.y,h=Math.sqrt(s*s+n*n);if(h<70){let o={x:s/h,y:n/h};this.direction=o,this.speed=this.baseSpeed*8,this.fleeing=!0,this.fleeingColor="yellow",this.size=12,setTimeout(()=>{this.speed=this.baseSpeed*1.3,this.fleeing=!1,this.fleeingColor="red",this.size=9},Math.random()*1500+500)}}}draw(){let t=0;if(!this.isFlying){let n=Date.now()*this.floatingSpeed;t=Math.sin(n+this.position.y)*this.floatingAmplitude}let i=this.position.x-S.x,s=this.position.y-S.y+t;if(i>=-10&&i<=b+10&&s>=-10&&s<=v+10&&(this.isFlying||(e.shadowColor="white",e.shadowBlur=32,e.fillStyle="white",e.globalAlpha=.8,e.beginPath(),e.arc(i,s,this.size*.8,0,Math.PI*2),e.fill(),e.globalAlpha=1,e.shadowColor="transparent",e.shadowBlur=0,e.shadowColor=this.shadowColor,e.shadowBlur=64,e.globalAlpha=.5,e.fillStyle=this.color,e.beginPath(),e.arc(i,s,this.size*1.2,0,Math.PI*2),e.fill(),e.globalAlpha=1,e.shadowColor="transparent",e.shadowBlur=0,e.fillStyle=this.color,e.globalAlpha=.9,e.beginPath(),e.arc(i,s,this.size,0,Math.PI*2),e.fill(),e.globalAlpha=1),this.isFlying)){let n=this.fleeing?this.fleeingBlinkInterval:this.blinkInterval,h=this.fleeingLastBlink||this.lastBlink,o=this.fleeing?6:5,l=this.size*1.1,r=Date.now();r-h>=n&&(this.fleeing?this.fleeingLastBlink=r:this.lastBlink=r),e.fillStyle="white",e.globalAlpha=.95,e.beginPath(),e.arc(i,s,l*.3,0,Math.PI*2),e.fill(),e.globalAlpha=1,e.shadowColor=this.shadowColor,e.shadowBlur=l*o*.8,e.fillStyle=this.color,e.globalAlpha=.7,e.beginPath(),e.arc(i,s,l*.6,0,Math.PI*2),e.fill(),e.globalAlpha=1,e.shadowColor="transparent",e.shadowBlur=0,e.shadowColor=this.shadowColor,e.shadowBlur=l*o*1.2,e.fillStyle=this.color,e.globalAlpha=.5,e.beginPath(),e.arc(i,s,l*.9,0,Math.PI*2),e.fill(),e.globalAlpha=1,e.shadowColor="transparent",e.shadowBlur=0,e.fillStyle=this.color,e.globalAlpha=.9,e.beginPath(),e.arc(i,s,l,0,Math.PI*2),e.fill(),e.globalAlpha=1}}};function H(){return Y[Math.floor(Math.random()*Y.length)]}function k(a,t,i){return a+(t-a)*i}function et(a,t,i){let s=(t-a+360)%360;return s>180&&(s-=360),a+s*i}var S={x:0,y:0,update:function(a,t){let s=a-b/2,n=t-v/2;this.x+=(s-this.x)*.1,this.y+=(n-this.y)*.1}};function j(a,t,i,s){let n;do n=U[Math.floor(Math.random()*U.length)];while(R.isNameTaken(n,s));let h=Math.random()*w,o=Math.random()*T;return new R(h,o,i,!0,n)}var G=[],E=[],x=new R(A.width/2,A.height/2,"#4444ff",!1,"Player");E.push(x);var $=x.findSafeSpawnPosition();x.reset($.x,$.y);for(let a=0;a<tt;a++){let t=j(Math.random()*A.width,Math.random()*A.height,H(),E);G.push(t),E.push(t)}var I=Array(J).fill(null).map(()=>new N),nt=9e3;setInterval(()=>{Math.random()<.4&&I.push(new N(!0))},nt);document.addEventListener("mousemove",a=>{if(!x.isAlive||x.isDying)return;let t=a.clientX-A.offsetLeft+S.x,i=a.clientY-A.offsetTop+S.y,s=x.segments[0],n=t-s.x,h=i-s.y,o={x:n,y:h},l=Math.sqrt(o.x*o.x+o.y*o.y);l>0?(o.x/=l,o.y/=l):o={x:1,y:0};let r=.5;x.targetDirection.x=k(x.targetDirection.x,o.x,r),x.targetDirection.y=k(x.targetDirection.y,o.y,r)});document.addEventListener("keydown",a=>{a.code==="Space"&&x.isAlive&&x.canSpeedBoost()&&(x.isSpeedingUp=!0,x.lastSpeedBoostTime=Date.now())});document.addEventListener("keyup",a=>{a.code==="Space"&&(x.isSpeedingUp=!1)});document.addEventListener("mousedown",a=>{a.button===0&&x.isAlive&&x.canSpeedBoost()&&(x.isSpeedingUp=!0)});document.addEventListener("mouseup",a=>{a.button===0&&(x.isSpeedingUp=!1)});function ot(a){let t=null,i=1/0,s=K(a);return st.forEach(n=>{let h=K(n),o=at(s,h);o<i&&(i=o,t=n)}),t}function K(a){let t=parseInt(a.slice(1,3),16),i=parseInt(a.slice(3,5),16),s=parseInt(a.slice(5,7),16);return{r:t,g:i,b:s}}function at(a,t){return Math.sqrt(.3*Math.pow(a.r-t.r,2)+.59*Math.pow(a.g-t.g,2)+.11*Math.pow(a.b-t.b,2))}function ht(){let t,i;do t=Math.random()*w,i=Math.random()*T;while(t<400||t>w-400||i<400||i>T-400);return{x:t,y:i}}function rt(){E.forEach(a=>{if(!a.isAlive||a.isDying)return;let t=a.segments[0];if(t.x<=0||t.x>=w||t.y<=0||t.y>=T){V(a);return}let i=a.direction;for(let s=I.length-1;s>=0;s--){let n=I[s];n.isFlying&&!n.fleeing&&n.flee(t,i);let h=t.x-n.position.x,o=t.y-n.position.y;if(Math.sqrt(h*h+o*o)<a.size+n.size){I.splice(s,1);let r=Math.random()<.1,c=Date.now();if(I.length<Q&&c-q>=it){let y=Math.random()<.1,d=ht(),g=new N(y);g.position=d,I.push(g),q=c}a.segments.length<a.MAX_LENGTH&&a.grow(n.value),a.foodEaten+=n.value*.2;break}}});for(let a=0;a<E.length;a++){let t=E[a];if(!t.isAlive||t.isDying)continue;let i=t.segments[0];for(let s=0;s<E.length;s++){let n=E[s];if(!(t===n||!n.isAlive||n.isDying))for(let h=0;h<n.segments.length;h++){let o=n.segments[h],l=i.x-o.x,r=i.y-o.y,c=Math.sqrt(l*l+r*r),y=h===0?n.size:n.size*.8;if(c<t.size+y*.7){V(t);return}}}}}function V(a){if(a.lives=Math.max(0,a.lives-1),a.isDying=!0,a.deathProgress=0,a.lives<=0){let t=[...a.segments],i=2.5,s=ot(a.color);t.forEach(o=>{let l=Math.random()*2*Math.PI,r=Math.random()*a.size*i,c=o.x+r*Math.cos(l),y=o.y+r*Math.sin(l),d=new N;d.color=s,d.position={x:c,y},I.push(d)});let n=G.indexOf(a);n!==-1&&G.splice(n,1);let h=E.indexOf(a);if(h!==-1&&E.splice(h,1),a.isBot){let o=j(0,0,lt(),E),l=o.findSafeSpawnPosition();o.reset(l.x,l.y);let r={x:0,y:0},c=-1;for(let m of E)if(m.isAlive&&m!==o){let f=o.segments[0].x-m.segments[0].x,p=o.segments[0].y-m.segments[0].y,u=Math.sqrt(f*f+p*p);u>c&&(c=u,r={x:-f,y:-p})}let y=Math.sqrt(r.x*r.x+r.y*r.y);if(y>0)r.x/=y,r.y/=y;else{r={x:Math.random()-.5,y:Math.random()-.5};let m=Math.sqrt(r.x*r.x+r.y*r.y);r.x/=m,r.y/=m}if(r.x!==o.direction.x||r.y!==o.direction.y)o.targetDirection=r;else{let m=Math.random()*.1-.05,f=r.x*Math.cos(m)-r.y*Math.sin(m),p=r.x*Math.sin(m)+r.y*Math.cos(m);o.targetDirection={x:f,y:p}}let d=.05;o.targetDirection.x+=(Math.random()-.5)*d,o.targetDirection.y+=(Math.random()-.5)*d;let g=Math.sqrt(o.targetDirection.x*o.targetDirection.x+o.targetDirection.y*o.targetDirection.y);o.targetDirection.x/=g,o.targetDirection.y/=g,o.direction=r,E.push(o),G.push(o)}}}function lt(){let a=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),i=Math.floor(Math.random()*256);return`rgb(${a}, ${t}, ${i})`}function ct(){_.innerHTML=E.map(t=>{let i="";return t.isAlive&&!t.isDying?i='<span class="active-indicator"></span>':t.lives>0&&(i='<span class="respawning-indicator">|</span>'),`
                <div class="player-stats">
                    <strong>${t.name}</strong>: 
                    ${t.lives} ${t.lives===1?"life":"lives"} | 
                    ${t.segments.length}/${t.getCurrentMaxLength()} |
                    ${i} 
                </div>
            `}).join(""),document.querySelectorAll(".respawning-indicator").forEach(t=>{let i=0,s=setInterval(()=>{i+=5,t.style.transform=`rotate(${i}deg)`,i>=360&&(i=0)},20)}),_.style.position="absolute",_.style.top="56px",_.style.left="1058px",_.style.color="white",_.style.fontSize="12px",_.style.fontFamily="sans-serif",_.style.pointerEvents="none",_.style.zIndex="100",_.style.opacity="10"}function gt(){F.clearRect(0,0,O.width,O.height);let a=Math.min(O.width/w,O.height/T);I.forEach(l=>{let r=l.position.x*a,c=l.position.y*a;F.fillStyle=l.isFlying?"gold":"lightgreen",F.beginPath(),F.arc(r,c,1,0,Math.PI*2),F.fill()});let t=x.segments[0].x*a,i=x.segments[0].y*a;F.fillStyle=x.color,F.beginPath(),F.arc(t,i,2,0,Math.PI*2),F.fill();let s=S.x*a,n=S.y*a,h=b*a,o=v*a;F.strokeStyle="white",F.lineWidth=1,F.strokeRect(s,n,h,o)}function dt(a){ct();let t=[...E];x.isAlive&&S.update(x.segments[0].x,x.segments[0].y),e.clearRect(0,0,b,v),e.strokeStyle="#FF4444",e.lineWidth=4,e.strokeRect(-S.x,-S.y,w,T),e.strokeStyle="#333333",e.lineWidth=1;let i=100,s=Math.floor(S.x/i)*i,n=Math.floor(S.y/i)*i;for(let h=s;h<S.x+b+i;h+=i)h>=0&&h<=w&&(e.beginPath(),e.moveTo(h-S.x,0),e.lineTo(h-S.x,v),e.stroke());for(let h=n;h<S.y+v+i;h+=i)h>=0&&h<=T&&(e.beginPath(),e.moveTo(0,h-S.y),e.lineTo(b,h-S.y),e.stroke());I.forEach(h=>{h.update(),h.draw()}),t.forEach(h=>{h.update(I,t,a),h.draw()}),rt()}var Z=performance.now();function z(){e.clearRect(0,0,A.width,A.height),gt();let a=performance.now(),t=(a-Z)/1e3;t=Math.min(t,1/30),dt(t),x.lives<=0?(e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,A.width,A.height),e.fillStyle="white",e.font="30px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("Game Over!",A.width/2,A.height/2),cancelAnimationFrame(z)):(Z=a,requestAnimationFrame(z))}z();})();
