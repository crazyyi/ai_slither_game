(()=>{var x=document.getElementById("gameCanvas"),_=x.height*3,B=x.width*3,C=x.width,N=x.height,h=x.getContext("2d"),L=document.getElementById("stats"),G=document.getElementById("radarCanvas"),v=G.getContext("2d");var J=240,Q=80,tt=5,it=2e3,et=150,st=300,q=0,nt=["#FF0000","#90EE90","#0000FF","#FFFF00","#FFA500","#800080","#00FFFF","#FF69B4","#FFD700","#ADFF2F","#FF4500","#1E90FF"],U=["Slitherin","Viper","Cobra","Python","Anaconda","Mamba","Asp","Rattler","Boa","Serpent","Sidewinder","Boomslang","Racer","Kingsnake","Coral","Cottonmouth","Copperhead","Harlequin","Gaboon","Moccasin"],k=["#FF69B4","#FFD700","#00FF00","#00FFFF","#FF00FF","#ADFF2F","#FFA500","#FFB6C1","#FFFF00","#00CED1","#90EE90","#FF7F50","#FF6347","#7CFC00","#AFEEEE","#F0E68C","#FFFAFA","#DA70D6","#DB7093","#FFC0CB","#FFEFD5","#FFA07A","#98FB98","#FFB347","#FFFFE0"],z=class{static isNameTaken(t,i){return i.some(e=>e.name===t&&e.isAlive&&!e.isDying)}constructor(t,i,e,n=!1,o="Player"){this.color=e,this.isBot=n,this.name=o,this.SAFE_SPAWN_DISTANCE=70,this.RESPAWN_TIME=180,this.MIN_SEGMENT_SIZE=1.5,this.BASE_LENGTH=50,this.MAX_LENGTH=Math.floor(this.BASE_LENGTH*6.6),this.GROWTH_RATE=.02,this.SPEED_BOOST_COST=2,this.BASE_SPEED=160,this.SPEED_BOOST=1.5,this.reset(t,i),this.size=6,this.lives=3,this.isAlive=!0,this.respawnTimer=0,this.targetPoint=null,this.opacity=1,this.isDying=!1,this.deathProgress=0,this.foodEaten=0,this.baseSpeed=this.BASE_SPEED,this.speed=this.baseSpeed,this.speedBoost=1.5,this.isSpeedingUp=!1,this.speedBoostCost=2,this.lastSpeedBoostTime=0,this.lastLengthChangeTime=0,this.cursorX=0,this.cursorY=0,this.trail=[],this.trailMaxLength=25,this.turningSpeed=.45,this.targetDirection={...this.direction},this.segmentSmoothing=.15,this.maxBendAngle=55,this.segmentSpacing=2.2,this.turnTighteningFactor=.3}reset(t,i){this.segments=[],this.segments.push({x:t,y:i}),this.direction={x:1,y:0},this.isAlive=!0,this.opacity=1,this.isDying=!1,this.deathProgress=0}getCurrentMaxLength(){let t=this.MAX_LENGTH-this.BASE_LENGTH,i=Math.min(t*this.foodEaten*this.GROWTH_RATE,t);return Math.floor(this.BASE_LENGTH+i)}grow(t){let e=1/Math.sqrt(this.segments.length),n=t*.1*e;this.foodEaten+=n;let o={...this.segments[this.segments.length-1]};this.segments.push(o)}update(t,i,e){this.updatedScale=this.segments.length>st?2.4:this.segments.length>et?2:1.6;let n=this.getCurrentMaxLength();if(this.isSpeedingUp){if(this.segments.length<=this.BASE_LENGTH){this.isSpeedingUp=!1,this.speed=this.baseSpeed;return}let m=Date.now();if(this.lastShrinkTime||(this.lastShrinkTime=m),m-this.lastShrinkTime>=200){if(this.segments.length>this.BASE_LENGTH){let S=this.segments.pop();if(S){let E=S.x+(Math.random()-.5)*10,D=S.y+(Math.random()-.5)*10,w=new R;w.position={x:E,y:D},t.push(w),this.foodEaten=Math.max(0,this.foodEaten-.2)}}else this.isSpeedingUp=!1;this.lastShrinkTime=m}this.speed=this.baseSpeed*this.SPEED_BOOST}else this.lastShrinkTime=null,this.speed=this.baseSpeed;if(this.isDying){this.deathProgress+=.02,this.opacity=Math.max(0,1-this.deathProgress),this.deathProgress>=1&&(this.isDying=!1,this.isAlive=!1,this.lives>0&&(this.respawnTimer=this.RESPAWN_TIME));return}if(!this.isAlive){if(this.lives<=0)return;this.respawnTimer--,this.respawnTimer<=0&&this.respawn();return}this.isBot&&this.updateAI(t,i);let o=Math.atan2(this.direction.y,this.direction.x)*180/Math.PI,r=Math.atan2(this.targetDirection.y,this.targetDirection.x)*180/Math.PI,c=ht(o,r,this.turningSpeed*e*5);this.direction.x=Math.cos(c*Math.PI/180),this.direction.y=Math.sin(c*Math.PI/180);let l=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);if(l===0?this.direction={x:1,y:0}:(this.direction.x/=l,this.direction.y/=l),this.targetDirection){let u=Math.atan2(this.direction.y,this.direction.x),M=Math.atan2(this.targetDirection.y,this.targetDirection.x)-u;for(;M>Math.PI;)M-=Math.PI*2;for(;M<-Math.PI;)M+=Math.PI*2;let E=u+M*.15;this.direction.x=Math.cos(E),this.direction.y=Math.sin(E)}let g=this.segments[0],y=this.speed*e,F={x:g.x+this.direction.x*y,y:g.y+this.direction.y*y};this.segments.unshift(F),this.applySegmentSmoothing(e),this.isSpeedingUp?(this.trail.push({x:F.x,y:F.y}),this.trail.length>this.trailMaxLength&&this.trail.shift()):this.trail=[];for(let m=1;m<this.segments.length;m++){let u=this.segments[m-1],S=this.segments[m],M=u.x-S.x,E=u.y-S.y,D=Math.sqrt(M*M+E*E),w=Math.abs(this.targetDirection.x-this.direction.x)+Math.abs(this.targetDirection.y-this.direction.y),p=this.size*(3-this.turnTighteningFactor*w);if(D>p){let T=this.size*(1.5+w)/D;S.x=u.x-M*T,S.y=u.y-E*T}}for(;this.segments.length>n;)this.segments.pop()}applySegmentSmoothing(t){let i=this.size*2,e=this.size*2.5,n=.25;for(let o=1;o<this.segments.length;o++){let r=this.segments[o-1],a=this.segments[o],c=r.x-a.x,l=r.y-a.y,g=Math.sqrt(c*c+l*l);if(g<i)continue;let y=c/g,F=l/g,m=i,u=Math.abs(this.targetDirection.x-this.direction.x+this.targetDirection.y-this.direction.y);m-=u*this.size*.3;let S=r.x-y*m,M=r.y-F*m;a.vx||(a.vx=0),a.vy||(a.vy=0);let E=Math.min(g/e,1),D=n*(1+E);a.vx+=(S-a.x)*D,a.vy+=(M-a.y)*D;let w=.8;a.vx*=w,a.vy*=w,a.x+=a.vx*t,a.y+=a.vy*t,g>e&&(a.x=r.x-y*e,a.y=r.y-F*e,a.vx=0,a.vy=0)}}calculateBendAngle(t){let i=this.segments[t-1],e=this.segments[t],n=e.x-i.x,o=e.y-i.y;return Math.atan2(o,n)*(180/Math.PI)}applyBend(t,i){let e=Math.min(Math.max(i,-this.maxBendAngle),this.maxBendAngle);t.x+=Math.cos(e*Math.PI/180)*this.size*.05,t.y+=Math.sin(e*Math.PI/180)*this.size*.05}canSpeedBoost(){return this.segments.length>this.BASE_LENGTH}updateAI(t,i){let e=this.segments[0],n=50,o=200,r=300,a=.85,c=this.direction.x,l=this.direction.y,g=null,y=o,F=null,m=r,u=null,S=n;if(i.forEach(p=>{if(p!==this&&p.isAlive&&!p.isDying){let T=p.segments[0],b=T.x-e.x,O=T.y-e.y,I=Math.sqrt(b*b+O*O),X=p.segments.length/this.segments.length;if(X>1.2&&I<n*1.5?I<S&&(S=I,u=p):X<a&&I<r&&I<m&&(m=I,F=p),I<n){let Y=1-I/n;c-=b/I*Y*2,l-=O/I*Y*2}}}),t.forEach(p=>{let T=p.position.x-e.x,b=p.position.y-e.y,O=Math.sqrt(T*T+b*b);O<y&&(y=O,g=p)}),u){let p=e.x-u.segments[0].x,T=e.y-u.segments[0].y,b=Math.sqrt(p*p+T*T);c=p/b,l=T/b}else if(F&&Math.random()<.7)c=(F.segments[0].x-e.x)/m,l=(F.segments[0].y-e.y)/m;else if(g)c=(g.position.x-e.x)/y,l=(g.position.y-e.y)/y;else{let p=Date.now()*.001;c=Math.cos(p*.5),l=Math.sin(p*.7)}let M=Math.sqrt(c*c+l*l),E={x:0,y:0};M>0&&(E={x:c/M,y:l/M});let D=.1;this.direction.x=this.direction.x*(1-D)+E.x*D,this.direction.y=this.direction.y*(1-D)+E.y*D;let w=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=w,this.direction.y/=w}getDistance(t,i){let e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)}respawn(){if(this.lives>0){let t=this.findSafeSpawnPosition();this.reset(t.x,t.y),this.targetPoint=null}}findSafeSpawnPosition(){let t=0,i;do i={x:Math.random()*(B-100)+50,y:Math.random()*(_-100)+50},t++;while(this.isPositionNearSnakes(i)&&t<10);return i}isPositionNearSnakes(t){return A.some(i=>i===this||!i.isAlive||i.isDying?!1:this.getDistance(t,i.segments[0])<this.SAFE_SPAWN_DISTANCE)}draw(){if(!this.isAlive&&!this.isDying)return;let t=1.6;if(h.globalAlpha=this.opacity,this.isSpeedingUp)for(let o=0;o<this.segments.length;o++){let r=this.segments[o],a=r.x-f.x,c=r.y-f.y;if(a>=-10&&a<=C+10&&c>=-10&&c<=N+10){let l=1-o/this.segments.length,g=.3*l;h.fillStyle=`rgba(255, 190, 0, ${g})`,h.beginPath(),h.arc(a,c,this.size*1.4*t*(1-o/this.segments.length/3),0,Math.PI*2),h.fill();let y=.5*l;h.fillStyle=`rgba(255, 153, 0, ${y})`,h.beginPath(),h.arc(a,c,this.size*1.2*t*(1-o/this.segments.length/3),0,Math.PI*2),h.fill()}}h.fillStyle=this.color;for(let o=this.segments.length-1;o>=0;o--){let r=this.segments[o],a=r.x-f.x,c=r.y-f.y;if(a>=-10&&a<=C+10&&c>=-10&&c<=N+10){let g=this.size*this.updatedScale;if(o===0){let y=this.direction.x*this.targetDirection.x+this.direction.y*this.targetDirection.y,F=Math.max(.3,y);g*=F}h.beginPath(),h.arc(a,c,g,0,Math.PI*2),h.fill(),h.strokeStyle="rgba(0, 0, 0, 0.5)",h.lineWidth=2,h.stroke()}}let i=this.segments[0],e=i.x-f.x,n=i.y-f.y;if(e>=-10&&e<=C+10&&n>=-10&&n<=N+10){h.fillStyle="white";let o=2*t,r=1.5*t,a=this.direction.x*o,c=this.direction.y*o;h.beginPath(),h.arc(e+a-c,n+c+a,r,0,Math.PI*2),h.arc(e+a+c,n+c-a,r,0,Math.PI*2),h.fill();let l=1,g=r*.8,y=this.targetDirection.x*l,F=this.targetDirection.y*l,m=this.targetDirection.x*l,u=this.targetDirection.y*l;h.fillStyle="black",h.beginPath(),h.arc(e+a-c+y,n+c+a+F,g,0,Math.PI*2),h.arc(e+a+c+m,n+c-a+u,g,0,Math.PI*2),h.fill(),h.fillStyle="rgba(250, 250, 250, 0.6)",h.font=`bold ${12*t}px Arial`,h.textAlign="center",h.textBaseline="bottom";let S=this.size*Math.max(1-0/this.segments.length,this.MIN_SEGMENT_SIZE)*t+5;h.fillText(this.name,e,n-S)}h.globalAlpha=1}},R=class{constructor(t=!1){this.size=t?8:4,this.value=t?3:1,this.isFlying=t,this.resetPosition(),this.color=this.isFlying?"gold":"lightgreen",this.shadowColor=this.isFlying?"rgba(255, 215, 0, 0.3)":"rgba(144, 238, 144, 0.3)",this.floatingSpeed=.01,this.floatingAmplitude=.8,this.isFlying&&(this.blinkInterval=500,this.lastBlink=0,this.isFlickering=!1,this.fleeingBlinkInterval=300,this.fleeingLastBlink=0,this.isFleeingFlickering=!1,this.setRandomDirection(),this.baseSpeed=1,this.speed=this.baseSpeed*1.3,this.wobbleInterval=150,this.lastWobble=Date.now(),this.maxWanderDistance=150,this.initialPosition={...this.position})}setRandomDirection(){this.direction={x:Math.random()-.5,y:Math.random()-.5};let t=Math.sqrt(this.direction.x*this.direction.x+this.direction.y*this.direction.y);this.direction.x/=t,this.direction.y/=t}resetPosition(){this.position={x:Math.random()*(B-100)+50,y:Math.random()*(_-100)+50}}update(){if(this.isFlying){if(!this.fleeing){let i=Date.now();i-this.lastWobble>this.wobbleInterval&&(this.setRandomDirection(),this.lastWobble=i)}if(this.position.x+=this.direction.x*this.speed,this.position.y+=this.direction.y*this.speed,this.position.x<0&&(this.position.x=B),this.position.x>B&&(this.position.x=0),this.position.y<0&&(this.position.y=_),this.position.y>_&&(this.position.y=0),this.getDistance(this.initialPosition,this.position)>this.maxWanderDistance){let i=this.initialPosition.x-this.position.x,e=this.initialPosition.y-this.position.y,n=Math.sqrt(i*i+e*e);this.direction.x=i/n,this.direction.y=e/n,this.speed=this.baseSpeed}else this.speed=this.baseSpeed*1.3}}getDistance(t,i){let e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)}flee(t,i){if(this.isFlying&&!this.fleeing){let e=this.position.x-t.x,n=this.position.y-t.y,o=Math.sqrt(e*e+n*n);if(o<70){let r={x:e/o,y:n/o};this.direction=r,this.speed=this.baseSpeed*8,this.fleeing=!0,this.fleeingColor="yellow",this.size=12,setTimeout(()=>{this.speed=this.baseSpeed*1.3,this.fleeing=!1,this.fleeingColor="red",this.size=9},Math.random()*1500+500)}}}draw(){let t=0;if(!this.isFlying){let n=Date.now()*this.floatingSpeed;t=Math.sin(n+this.position.y)*this.floatingAmplitude}let i=this.position.x-f.x,e=this.position.y-f.y+t;if(i>=-10&&i<=C+10&&e>=-10&&e<=N+10&&(this.isFlying||(h.fillStyle=this.shadowColor,h.beginPath(),h.arc(i,e,this.size*1.1,0,Math.PI*2),h.fill()),h.fillStyle=this.color,h.beginPath(),h.arc(i,e,this.size,0,Math.PI*2),h.fill(),this.isFlying)){let n=this.blinkInterval,o=this.isFleeingFlickering?this.isFleeingFlickering:this.isFlickering,r=this.fleeingLastBlink||this.lastBlink,a=this.fleeing?1.4:1.2,c=Date.now();c-r>=n&&(this.fleeing?(this.isFleeingFlickering=!this.isFleeingFlickering,this.fleeingLastBlink=c):(this.isFlickering=!this.isFlickering,this.lastBlink=c)),o&&(h.fillStyle=this.shadowColor,h.beginPath(),h.arc(i,e,this.size*a,0,Math.PI*2),h.fill())}}};function ot(){return k[Math.floor(Math.random()*k.length)]}function $(s,t,i){return s+(t-s)*i}function ht(s,t,i){let e=(t-s+360)%360;return e>180&&(e-=360),s+e*i}var f={x:0,y:0,update:function(s,t){let e=s-C/2,n=t-N/2;this.x+=(e-this.x)*.1,this.y+=(n-this.y)*.1}},d=new z(x.width/2,x.height/2,"#4444ff",!1,"Player"),H=[],A=[d];for(let s=0;s<tt;s++){let t=j(Math.random()*x.width,Math.random()*x.height,ot(),A);H.push(t),A.push(t)}function j(s,t,i,e){let n;do n=U[Math.floor(Math.random()*U.length)];while(z.isNameTaken(n,e));let o=Math.random()*B,r=Math.random()*_;return new z(o,r,i,!0,n)}var P=Array(Q).fill(null).map(()=>new R),at=9e3;setInterval(()=>{Math.random()<.2&&P.push(new R(!0))},at);document.addEventListener("mousemove",s=>{if(!d.isAlive||d.isDying)return;let t=s.clientX-x.offsetLeft+f.x,i=s.clientY-x.offsetTop+f.y,e=d.segments[0],n=t-e.x,o=i-e.y,r={x:n,y:o},a=Math.sqrt(r.x*r.x+r.y*r.y);a>0?(r.x/=a,r.y/=a):r={x:1,y:0};let c=.5;d.targetDirection.x=$(d.targetDirection.x,r.x,c),d.targetDirection.y=$(d.targetDirection.y,r.y,c)});document.addEventListener("keydown",s=>{s.code==="Space"&&d.isAlive&&d.canSpeedBoost()&&(d.isSpeedingUp=!0,d.lastSpeedBoostTime=Date.now())});document.addEventListener("keyup",s=>{s.code==="Space"&&(d.isSpeedingUp=!1)});document.addEventListener("mousedown",s=>{s.button===0&&d.isAlive&&d.canSpeedBoost()&&(d.isSpeedingUp=!0)});document.addEventListener("mouseup",s=>{s.button===0&&(d.isSpeedingUp=!1)});function rt(s){let t=null,i=1/0,e=V(s);return nt.forEach(n=>{let o=V(n),r=ct(e,o);r<i&&(i=r,t=n)}),t}function V(s){let t=parseInt(s.slice(1,3),16),i=parseInt(s.slice(3,5),16),e=parseInt(s.slice(5,7),16);return{r:t,g:i,b:e}}function ct(s,t){return Math.sqrt(.3*Math.pow(s.r-t.r,2)+.59*Math.pow(s.g-t.g,2)+.11*Math.pow(s.b-t.b,2))}function lt(){A.forEach(s=>{if(!s.isAlive||s.isDying)return;let t=s.segments[0];if(t.x<=0||t.x>=B||t.y<=0||t.y>=_){K(s);return}let i=s.direction;for(let e=P.length-1;e>=0;e--){let n=P[e];n.isFlying&&!n.fleeing&&n.flee(t,i);let o=t.x-n.position.x,r=t.y-n.position.y;if(Math.sqrt(o*o+r*r)<s.size+n.size){P.splice(e,1);let c=Math.random()<.1,l=Date.now();P.length<J&&l-q>=it&&(P.push(new R(c)),q=l),s.segments.length<s.MAX_LENGTH&&s.grow(n.value),s.foodEaten+=n.value*.2;break}}});for(let s=0;s<A.length;s++){let t=A[s];if(!t.isAlive||t.isDying)continue;let i=t.segments[0];for(let e=0;e<A.length;e++){let n=A[e];if(!(t===n||!n.isAlive||n.isDying))for(let o=0;o<n.segments.length;o++){let r=n.segments[o],a=i.x-r.x,c=i.y-r.y,l=Math.sqrt(a*a+c*c),g=o===0?n.size:n.size*.8;if(l<t.size+g*.7){K(t);return}}}}}function K(s){if(s.lives=Math.max(0,s.lives-1),s.isDying=!0,s.deathProgress=0,s.lives<=0){let t=[...s.segments],i=2.5,e=rt(s.color);t.forEach(r=>{let a=Math.random()*2*Math.PI,c=Math.random()*s.size*i,l=r.x+c*Math.cos(a),g=r.y+c*Math.sin(a),y=new R;y.color=e,y.position={x:l,y:g},P.push(y)});let n=H.indexOf(s);n!==-1&&H.splice(n,1);let o=A.indexOf(s);if(o!==-1&&A.splice(o,1),s.isBot){let r=Math.random()*x.width,a=Math.random()*x.height,c=j(r,a,gt(),A);A.push(c),H.push(c)}}else console.log(`${s.name} lost a life! Remaining lives: ${s.lives}`)}function gt(){let s=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),i=Math.floor(Math.random()*256);return`rgb(${s}, ${t}, ${i})`}function dt(){L.innerHTML=A.map(s=>{let t=s.isAlive&&!s.isDying?"alive":"dead",i="Dead";return s.isAlive?i="Active":s.isDying?i="Dying...":s.lives>0&&(i="Respawning..."),`
          <div class="player-stats ${t}">
            <strong>${s.name}</strong>: 
            ${s.lives} ${s.lives===1?"life":"lives"} | 
            Length: ${s.segments.length}/${s.getCurrentMaxLength()} |
            Status: ${i}
          </div>
        `}).join(""),L.style.position="absolute",L.style.top="10px",L.style.left="10px",L.style.backgroundColor="rgba(255, 255, 255, 0.7)",L.style.fontSize="14px",L.style.padding="5px"}function ft(){v.clearRect(0,0,G.width,G.height);let s=Math.min(G.width/B,G.height/_);P.forEach(a=>{let c=a.position.x*s,l=a.position.y*s;v.fillStyle=a.isFlying?"gold":"lightgreen",v.beginPath(),v.arc(c,l,2,0,Math.PI*2),v.fill()});let t=d.segments[0].x*s,i=d.segments[0].y*s;v.fillStyle=d.color,v.beginPath(),v.arc(t,i,4,0,Math.PI*2),v.fill();let e=f.x*s,n=f.y*s,o=C*s,r=N*s;v.strokeStyle="white",v.lineWidth=1,v.strokeRect(e,n,o,r)}function yt(s){let t=[...A];d.isAlive&&f.update(d.segments[0].x,d.segments[0].y),h.clearRect(0,0,C,N),h.strokeStyle="#FF4444",h.lineWidth=4,h.strokeRect(-f.x,-f.y,B,_),h.strokeStyle="#333333",h.lineWidth=1;let i=100,e=Math.floor(f.x/i)*i,n=Math.floor(f.y/i)*i;for(let o=e;o<f.x+C+i;o+=i)o>=0&&o<=B&&(h.beginPath(),h.moveTo(o-f.x,0),h.lineTo(o-f.x,N),h.stroke());for(let o=n;o<f.y+N+i;o+=i)o>=0&&o<=_&&(h.beginPath(),h.moveTo(0,o-f.y),h.lineTo(C,o-f.y),h.stroke());P.forEach(o=>{o.update(),o.draw()}),t.forEach(o=>{o.update(P,t,s),o.draw()}),lt(),dt()}var Z=performance.now();function W(){h.clearRect(0,0,x.width,x.height),ft();let s=performance.now(),t=(s-Z)/1e3;t=Math.min(t,1/30),yt(t),d.lives<=0?(h.fillStyle="rgba(0, 0, 0, 0.5)",h.fillRect(0,0,x.width,x.height),h.fillStyle="white",h.font="30px Arial",h.textAlign="center",h.textBaseline="middle",h.fillText("Game Over!",x.width/2,x.height/2),cancelAnimationFrame(W)):(Z=s,requestAnimationFrame(W))}W();})();
